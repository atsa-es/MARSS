<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="MARSS">
<title>Quick Start Guide • MARSS</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><script src="../extra.js"></script><meta property="og:title" content="Quick Start Guide">
<meta property="og:description" content="MARSS">
<meta property="og:image" content="https://atsa-es.github.io/MARSS/logo.png">
<!-- mathjax --><script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js">
</script><!--
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
--><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MARSS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.11.7</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/atsa-es/MARSS/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Quick Start Guide</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/atsa-es/MARSS/blob/HEAD/vignettes/Quick_Start.Rmd" class="external-link"><code>vignettes/Quick_Start.Rmd</code></a></small>
      <div class="d-none name"><code>Quick_Start.Rmd</code></div>
    </div>

    
    
<div class="section level2" number="1">
<h2 id="tldr">
<span class="header-section-number">1</span> tldr;<a class="anchor" aria-label="anchor" href="#tldr"></a>
</h2>
<p>Put data (<code>y</code>) in a <span class="math inline">\(n \times
T\)</span> matrix or ts/mts object.</p>
<p>Specify each of the parameters in a list for the <code>model</code>
argument.</p>
<p>Fit with</p>
<pre><code><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MARSS.html">MARSS</a></span><span class="op">(</span><span class="va">y</span>, model<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>, method<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"kem"</span>, <span class="st">"BFGS"</span>, <span class="st">"TMB"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<p>Choose one method from <code>c("kem", "BFGS", "TMB")</code>.</p>
<p><em>Specification of a properly constrained model with a unique
solution is the responsibility of the user because the {MARSS} package
has no way to tell if you have specified an insufficiently constrained
model.</em></p>
</div>
<div class="section level2" number="2">
<h2 id="the-marss-model">
<span class="header-section-number">2</span> The MARSS model<a class="anchor" aria-label="anchor" href="#the-marss-model"></a>
</h2>
<p>The {MARSS} package fits multivariate autoregressive state-space
(MARSS) models of the form: <span class="math display">\[\begin{equation}
\begin{gathered}
\boldsymbol{x}_t = \mbox{$\mathbf B$}_t\boldsymbol{x}_{t-1} +
\mbox{$\mathbf U$}_t + \mbox{$\mathbf C$}_t\mbox{$\mathbf c$}_t +
\mbox{$\mathbf G$}_t\boldsymbol{w}_t, \text{ where } \boldsymbol{W}_t
\sim \,\textup{\textrm{MVN}}(0,\mbox{$\mathbf Q$}_t)\\
\boldsymbol{y}_t = \mbox{$\mathbf Z$}_t\boldsymbol{x}_t + \mbox{$\mathbf
A$}_t + \mbox{$\mathbf D$}_t\mbox{$\mathbf d$}_t + \mbox{$\mathbf
H$}_t\boldsymbol{v}_t, \text{ where } \boldsymbol{V}_t \sim
\,\textup{\textrm{MVN}}(0,\mbox{$\mathbf R$}_t)\\
\boldsymbol{X}_1 \sim
\,\textup{\textrm{MVN}}(\boldsymbol{\xi},\boldsymbol{\Lambda}) \text{ or
} \boldsymbol{X}_0 \sim
\,\textup{\textrm{MVN}}(\boldsymbol{\xi},\boldsymbol{\Lambda})
\end{gathered}
\end{equation}\]</span> <span class="math inline">\(\mbox{$\mathbf
c$}\)</span> and <span class="math inline">\(\mbox{$\mathbf d$}\)</span>
are inputs (aka, exogenous variables or covariates or indicator
variables) and must have no missing values. The <span class="math inline">\(\mbox{$\mathbf R$}\)</span>, <span class="math inline">\(\mbox{$\mathbf Q$}\)</span> and <span class="math inline">\(\boldsymbol{\Lambda}\)</span> variances can can
have zeros on the diagonal to specify partially deterministic systems.
This allows you to write MAR(p) models in MARSS form for example. See
the User Guide. The {MARSS} package is designed to handle linear
constraints within the parameter matrices. Linear constraint means you
can write the elements of the matrix as a linear equation of all the
other elements. See section below on linear constraints.</p>
<p>Example: a mean-reverting random walk model with three observation
time series: <span class="math display">\[\begin{gather}
\begin{bmatrix}x_1\\ x_2\end{bmatrix}_t
= \begin{bmatrix}b&amp;0\\ 0&amp;b\end{bmatrix}
\begin{bmatrix}x_1\\ x_2\end{bmatrix}_{t-1}
+ \begin{bmatrix}w_1\\ w_2\end{bmatrix}_t, \quad
\begin{bmatrix}w_1\\ w_2\end{bmatrix}_t \sim
\,\textup{\textrm{MVN}}\begin{pmatrix}\begin{bmatrix}0\\0\end{bmatrix},\begin{bmatrix}q_{11}&amp;q_{12}\\
q_{12}&amp;q_{22}\end{bmatrix} \end{pmatrix}
\\
\begin{bmatrix}y_1\\y_2\\y_3\end{bmatrix}_t
= \begin{bmatrix}1&amp;1\\ 0&amp;1\\ 1&amp;0\end{bmatrix}
\begin{bmatrix}x_1\\x_2\end{bmatrix}_t
+ \begin{bmatrix}v_1\\ v_2\\ v_3\end{bmatrix}_t,\quad
\begin{bmatrix}v_1\\ v_2\\ v_3\end{bmatrix}_t \sim
\,\textup{\textrm{MVN}}\begin{pmatrix}\begin{bmatrix}a_1\\ 0\\
0\end{bmatrix},
\begin{bmatrix}r_{11}&amp;0&amp;0\\ 0&amp;r&amp;0\\
0&amp;0&amp;r\end{bmatrix} \end{pmatrix}
\\
\begin{bmatrix}x_1\\ x_2\end{bmatrix}_0 \sim
\,\textup{\textrm{MVN}}\begin{pmatrix}\begin{bmatrix}0\\
0\end{bmatrix},\begin{bmatrix}1&amp;0\\ 0&amp;1\end{bmatrix}
\end{pmatrix}
\end{gather}\]</span></p>
<div class="section level3" number="2.1">
<h3 id="model-specification">
<span class="header-section-number">2.1</span> Model
specification<a class="anchor" aria-label="anchor" href="#model-specification"></a>
</h3>
<p>Model specification is via a list with the structure of each of the
model parameters: <span class="math inline">\(\mbox{$\mathbf
B$}\)</span>, <span class="math inline">\(\mbox{$\mathbf U$}\)</span>,
<span class="math inline">\(\mbox{$\mathbf C$}\)</span>, <span class="math inline">\(\mbox{$\mathbf Q$}\)</span>, <span class="math inline">\(\mbox{$\mathbf Z$}\)</span>, <span class="math inline">\(\mbox{$\mathbf A$}\)</span>, <span class="math inline">\(\mbox{$\mathbf D$}\)</span>, <span class="math inline">\(\mbox{$\mathbf R$}\)</span>, <span class="math inline">\(\boldsymbol{\xi}\)</span>, and<span class="math inline">\(\boldsymbol{\Lambda}\)</span>. There is a
one-to-one correspondence between the model in and the math version of
the model. The model written in matrix form is translated into
equivalent matrices (or arrays if time-varying) in code. Matrices that
combine fixed and estimated values are specified using a list matrix
with numerical values for fixed values and character names for the
estimated values.</p>
<p>For the MARSS model above, this would be:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">B1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"b"</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="st">"b"</span><span class="op">)</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">U1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">Q1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"q11"</span>,<span class="st">"q12"</span>,<span class="st">"q12"</span>,<span class="st">"q22"</span><span class="op">)</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">Z1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,<span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">A1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"a1"</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">R1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"r11"</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="st">"r"</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="st">"r"</span><span class="op">)</span>,<span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">pi1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>; <span class="va">V1</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">model.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>B<span class="op">=</span><span class="va">B1</span>,U<span class="op">=</span><span class="va">U1</span>,Q<span class="op">=</span><span class="va">Q1</span>,Z<span class="op">=</span><span class="va">Z1</span>,A<span class="op">=</span><span class="va">A1</span>,R<span class="op">=</span><span class="va">R1</span>,x0<span class="op">=</span><span class="va">pi1</span>,V0<span class="op">=</span><span class="va">V1</span>,tinitx<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>The <code>tinitx</code> element tells MARSS whether the initial state
for <span class="math inline">\(x\)</span> is at <span class="math inline">\(t=1\)</span> (<code>tinitx=1</code>) or <span class="math inline">\(t=0\)</span> (<code>tinitx=0</code>).</p>
<p>MARSS has a number of text shortcuts for common parameter forms, such
as <code>"diagonal and unequal"</code>; see below for the possible
shortcuts.</p>
</div>
</div>
<div class="section level2" number="3">
<h2 id="data-and-fitting">
<span class="header-section-number">3</span> Data and fitting<a class="anchor" aria-label="anchor" href="#data-and-fitting"></a>
</h2>
<div class="section level3" number="3.1">
<h3 id="data">
<span class="header-section-number">3.1</span> Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>The data must be entered as a <span class="math inline">\(n \times
T\)</span> matrix, or a <code><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts()</a></code> (or mts) object or vector
(which will be converted to a <span class="math inline">\(n \times
T\)</span> matrix).</p>
</div>
<div class="section level3" number="3.2">
<h3 id="fit-call">
<span class="header-section-number">3.2</span> Fit call<a class="anchor" aria-label="anchor" href="#fit-call"></a>
</h3>
<p>The call to fit the model is.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MARSS.html">MARSS</a></span><span class="op">(</span><span class="va">y</span>, model<span class="op">=</span><span class="va">model.list</span><span class="op">)</span></span></code></pre></div>
<p>See <code><a href="../reference/MARSS.html">?MARSS</a></code> for all other arguments. The common ones are
<code>method</code> to change the fitting method from default of EM
(slow). See below. <code>control</code> is used to pass in a list to
control fitting, e.g. <code>control=list(maxit=1000)</code> to increase
maximum iterations if the fit does not converge.</p>
<p>Example with simulated data:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://atsa-es.github.io/MARSS/">MARSS</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/arima.sim.html" class="external-link">arima.sim</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">50</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ar<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span>, sd<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span>, </span>
<span>           <span class="fu"><a href="https://rdrr.io/r/stats/arima.sim.html" class="external-link">arima.sim</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">50</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ar<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span>, sd<span class="op">=</span><span class="fl">.02</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">Z1</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">3</span><span class="op">*</span><span class="fl">50</span>,<span class="fl">0</span>,<span class="fl">0.1</span><span class="op">)</span>, <span class="fl">3</span>, <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MARSS.html">MARSS</a></span><span class="op">(</span><span class="va">y</span>, model<span class="op">=</span><span class="va">model.list</span>, silent<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/tidy_marssMLE.html">tidy</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    term     estimate    std.error      conf.low      conf.up</span></span>
<span><span class="co">## 1  A.a1 0.0184598413 0.0269628326 -0.0343863395 0.0713060221</span></span>
<span><span class="co">## 2 R.r11 0.0188070225 0.0062216241  0.0066128633 0.0310011817</span></span>
<span><span class="co">## 3   R.r 0.0115645650 0.0024433098  0.0067757658 0.0163533641</span></span>
<span><span class="co">## 4   B.b 0.8605716318 0.0634069752  0.7362962441 0.9848470195</span></span>
<span><span class="co">## 5 Q.q11 0.1301323970 0.0288070155  0.0736716842 0.1865931098</span></span>
<span><span class="co">## 6 Q.q12 0.0020987299 0.0029632765 -0.0037091853 0.0079066452</span></span>
<span><span class="co">## 7 Q.q22 0.0001353807 0.0003058603 -0.0004640944 0.0007348558</span></span></code></pre>
</div>
<div class="section level3" number="3.3">
<h3 id="different-fitting-methods">
<span class="header-section-number">3.3</span> Different fitting
methods<a class="anchor" aria-label="anchor" href="#different-fitting-methods"></a>
</h3>
<p>The EM algorithm in the {MARSS} package is in R and on top of that EM
algorithms are famously slow. You can try <code>method="BFGS"</code> and
see if that is faster. For some models, it will be much faster and for
others slower. The companion package {<a href="https://atsa-es.github.io/marssTMB/" class="external-link">marssTMB</a>} allows you to
fit these models with TMB and will be the fastest, often much faster.
Definitely if you are doing Dynamic Factor Analysis or working with
large data sets, you will want to use {marssTMB}.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MARSS.html">MARSS</a></span><span class="op">(</span><span class="va">y</span>, model<span class="op">=</span><span class="va">model.list</span><span class="op">)</span></span>
<span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MARSS.html">MARSS</a></span><span class="op">(</span><span class="va">y</span>, model<span class="op">=</span><span class="va">model.list</span>, method<span class="op">=</span><span class="st">"BFGS"</span><span class="op">)</span></span>
<span><span class="va">fit3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MARSS.html">MARSS</a></span><span class="op">(</span><span class="va">y</span>, model<span class="op">=</span><span class="va">model.list</span>, method<span class="op">=</span><span class="st">"TMB"</span><span class="op">)</span></span></code></pre></div>
<p><code>method="BFGS"</code> and <code>method="TMB"</code> are both
using quasi-Newton methods to optimize and these can be sensitive to
initial conditions. You can run EM a few iterations use that as initial
conditions for BFGS or TMB, and this will guard against poor initial
conditions issues.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MARSS.html">MARSS</a></span><span class="op">(</span><span class="va">y</span>, model<span class="op">=</span><span class="va">model.list</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit<span class="op">=</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MARSS.html">MARSS</a></span><span class="op">(</span><span class="va">y</span>, model<span class="op">=</span><span class="va">model.list</span>, method<span class="op">=</span><span class="st">"BFGS"</span>, inits <span class="op">=</span> <span class="va">fit1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="3.4">
<h3 id="defaults-for-model-list">
<span class="header-section-number">3.4</span> Defaults for
<code>model</code> list<a class="anchor" aria-label="anchor" href="#defaults-for-model-list"></a>
</h3>
<p>Form of the model list is <code>list(B=..., U=...)</code> etc.</p>
<div class="section level4" number="3.4.1">
<h4 id="formmarxss">
<span class="header-section-number">3.4.1</span>
<code>form="marxss"</code><a class="anchor" aria-label="anchor" href="#formmarxss"></a>
</h4>
<p>For <code>form="marxss"</code> (the default), matrix names in the
model list must be <code>B</code>, <code>U</code>, <code>C</code>,
<code>c</code>, <code>Q</code>, <code>Z</code>, <code>A</code>,
<code>D</code>, <code>d</code>, <code>R</code>, <code>x0</code> (<span class="math inline">\(\boldsymbol{\xi}\)</span>), and <code>V0</code>
(<span class="math inline">\(\boldsymbol{\Lambda}\)</span>), just like
in the MARSS equation. There are defaults each parameter and you can
leave off matrix names and the defaults will be used. Type
<code><a href="../reference/MARSS_marxss.html">?MARSS.marxss</a></code> additional information.</p>
<ul>
<li>
<code>B="identity"</code> <span class="math inline">\(m \times
m\)</span> identity matrix</li>
<li>
<code>U="unequal"</code> Each element in the <span class="math inline">\(m \times 1\)</span> matrix <span class="math inline">\(\mbox{$\mathbf U$}\)</span> is estimated and
allowed to be different.</li>
<li>
<code>Q="diagonal and unequal"</code> <span class="math inline">\(\mbox{$\mathbf Q$}\)</span> is a diagonal matrix
and each element on the diagonal is allowed to be different.</li>
<li>
<code>Z="identity"</code> <span class="math inline">\(n \times
n\)</span> identity matrix thus in the default model each <span class="math inline">\(y\)</span> is associated with one <span class="math inline">\(x\)</span>.</li>
<li>
<code>A="scaling"</code> If <span class="math inline">\(\mbox{$\mathbf Z$}\)</span> is identity, <span class="math inline">\(\mbox{$\mathbf A$}\)</span> is zero. Otherwise,
the first <span class="math inline">\(y\)</span> associated with a <span class="math inline">\(x\)</span> is set to 0 and the rest are
estimated.</li>
<li>
<code>R="diagonal and equal"</code> <span class="math inline">\(\mbox{$\mathbf R$}\)</span> is a diagonal matrix
and each element on the diagonal is the same.</li>
<li>
<code>x0="unequal"</code> Each element in the <span class="math inline">\(m \times 1\)</span> matrix <span class="math inline">\(\boldsymbol{\xi}\)</span> is estimated and allowed
to be different.</li>
<li>
<code>V0="zero"</code> <span class="math inline">\(\boldsymbol{\Lambda}\)</span> is set to zero thus
<span class="math inline">\(\boldsymbol{x}_0\)</span> is treated as an
estimated parameter.</li>
<li>
<code>tinitx=0</code> The initial condition for <span class="math inline">\(\boldsymbol{x}\)</span> is set at <span class="math inline">\(t=0\)</span>.</li>
</ul>
</div>
<div class="section level4" number="3.4.2">
<h4 id="formdfa">
<span class="header-section-number">3.4.2</span>
<code>form="dfa"</code><a class="anchor" aria-label="anchor" href="#formdfa"></a>
</h4>
<p>Special form for fitting DFA models. Pass in <code>form="dfa"</code>
to the <code><a href="../reference/MARSS.html">MARSS()</a></code> call. Typically only these would be in the
model list:</p>
<ul>
<li>
<code>m=1</code> Number of factors.</li>
<li>
<code>R="diagonal and equal"</code> <span class="math inline">\(\mbox{$\mathbf R$}\)</span> is a diagonal matrix
and each element on the diagonal is the same.</li>
<li>
<code>d="zero"</code> If there are <span class="math inline">\(p\)</span> covariates, pass in as a <span class="math inline">\(p \times T\)</span> matrix.</li>
<li>
<code>D="unconstrained"</code> if covariates passed in.</li>
</ul>
<p>Defaults.</p>
<ul>
<li>
<code>Z</code> A special unconstrained matrix with the upper
triangle (without the diagonal) set to zero.</li>
<li>
<code>Q="identity"</code> <span class="math inline">\(\mbox{$\mathbf
Q$}\)</span> is a diagonal matrix and each element on the diagonal is
allowed to be different.</li>
<li>
<code>x0="zero"</code> Each element in the <span class="math inline">\(m \times 1\)</span> matrix <span class="math inline">\(\boldsymbol{\xi}\)</span> is estimated and allowed
to be different.</li>
<li>
<code>V0=diag(5,n)</code> <span class="math inline">\(\boldsymbol{\Lambda}\)</span> is set to a diagonal
matrix with 5 on the diagonal.</li>
<li>
<code>tinitx=0</code> The initial condition for <span class="math inline">\(\boldsymbol{x}\)</span> is set at <span class="math inline">\(t=0\)</span>.</li>
<li>
<code>B="identity"</code> <span class="math inline">\(m \times
m\)</span> identity matrix</li>
<li><code>U="zero"</code></li>
<li><code>A="zero"</code></li>
</ul>
</div>
</div>
</div>
<div class="section level2" number="4">
<h2 id="showing-the-model-fits-and-getting-the-parameters">
<span class="header-section-number">4</span> Showing the model fits
and getting the parameters<a class="anchor" aria-label="anchor" href="#showing-the-model-fits-and-getting-the-parameters"></a>
</h2>
<p>There are <code><a href="../reference/plot_marssMLE.html">plot.marssMLE()</a></code>,
<code><a href="../reference/plot_marssMLE.html">autoplot.marssMLE()</a></code>, <code>print</code>,
<code>summary</code>, <code>coef</code>, <code>fitted</code>,
<code>residuals</code> and <code>predict</code> functions for marssMLE
objects. <code>?print.MARSS</code> will show you how to get standard
output from your fitted model objects and where that output is stored in
the marssMLE object. See <code><a href="../reference/coef_marssMLE.html">coef.marssMLE()</a></code> for the different
formats for displaying the estimated parameters. To see plots of your
states and fits plus diagnostic plots, use <code>plot(fit)</code> or,
better, <code>ggplot2::autoplot(fit)</code>. For summaries of the
residuals (model and state), use the <code>residuals</code> function.
See <code><a href="../reference/residuals_marssMLE.html">?residuals.marssMLE</a></code>. To produce predictions and
forecasts from a MARSS model, see <code><a href="../reference/predict_marssMLE.html">?predict.marssMLE</a></code>.</p>
</div>
<div class="section level2" number="5">
<h2 id="tips-and-troubleshooting">
<span class="header-section-number">5</span> Tips and
Troubleshooting<a class="anchor" aria-label="anchor" href="#tips-and-troubleshooting"></a>
</h2>
<div class="section level3" number="5.1">
<h3 id="tips">
<span class="header-section-number">5.1</span> Tips<a class="anchor" aria-label="anchor" href="#tips"></a>
</h3>
<p>Use <code>ggplot2::autoplot(fit)</code> (or <code>plot(fit)</code>)
to see a series of standard plots and diagnostics for your model. Use
<code>tidy(fit)</code> for parameter estimates or
<code>coef(fit)</code>. Use <code>fitted(fit)</code> for model (<span class="math inline">\(\boldsymbol{y}\)</span>) estimates and
<code>tsSmooth(fit)</code> for states (<span class="math inline">\(\boldsymbol{x}\)</span>) estimates. You can also
use <code>fit$states</code> for the states.</p>
<p>Let’s say you specified your model with some text short-cuts, like
<code>Q="unconstrained"</code>, but you want the list matrix for for a
next step. <code>a &lt;- summary(fit$model)</code> returns that list
(invisibly). Because the model argument of <code><a href="../reference/MARSS.html">MARSS()</a></code> will
understand a list of list matrices, you can pass in <code>model=a</code>
to specify the model.
<code>MARSSkfas(fit, return.kfas.model=TRUE)</code> will return your
model in {KFAS} format (class SSModel), thus you can use all the
functions available in the {KFAS} package on your model.</p>
</div>
<div class="section level3" number="5.2">
<h3 id="troubleshooting">
<span class="header-section-number">5.2</span> Troubleshooting<a class="anchor" aria-label="anchor" href="#troubleshooting"></a>
</h3>
<p>Try <code><a href="../reference/MARSSinfo.html">MARSSinfo()</a></code> if you get errors you don’t understand
or fitting is taking a long time to converge. When fitting a model with
<code><a href="../reference/MARSS.html">MARSS()</a></code>, pass in <code>silent=2</code> to see what
<code><a href="../reference/MARSS.html">MARSS()</a></code> is doing. This puts it in verbose mode. Use
<code>fit=FALSE</code> to set up a model without fitting. Let’s say you
do <code>fit &lt;- MARSS(..., fit=FALSE)</code>. Now you can do
<code>summary(fit$model)</code> to see what <code><a href="../reference/MARSS.html">MARSS()</a></code> thinks
you are trying to fit.</p>
<p>You can also try <code>toLatex(fit$model)</code> to make a LaTeX file
and pdf version of your model (saved in the working directory). This
loads the {Hmisc} package (and all its dependencies) and requires that
you are able to process LaTeX files.</p>
</div>
</div>
<div class="section level2" number="6">
<h2 id="more-information-and-tutorials">
<span class="header-section-number">6</span> More information and
tutorials<a class="anchor" aria-label="anchor" href="#more-information-and-tutorials"></a>
</h2>
<p>Many example analyses can be found in the MARSS User Guide (<a href="https://CRAN.R-project.org/package=MARSS/vignettes/UserGuide.pdf" class="external-link">pdf</a>).
In addition, recorded lectures and more examples on fitting multivariate
models can be found at our course <a href="https://atsa-es.github.io/atsa/" class="external-link">website</a> and in the ATSA
course eBook <a href="https://atsa-es.github.io/atsa-labs/" class="external-link">html</a>.</p>
<p>The MARSS User Guide starts with some tutorials on MARSS models and
walks through many examples showing how to write multivariate
time-series models in MARSS form. The User Guide also has vignettes: how
to write AR(p) models in state-space form, dynamic linear models
(regression models where the regression parameters are AR(p)),
multivariate regression models with regression parameters that are
time-varying and enter the non-AR part of your model or the AR part,
detecting breakpoints using state-space models, and dynamic factor
analysis. All of these can be written in MARSS form. It also has a
series of vignettes on analysis of multivariate biological data.</p>
<p>Background on the algorithms used in the {MARSS} package is included
in the User Guide.</p>
</div>
<div class="section level2" number="7">
<h2 id="shortcuts-and-all-allowed-model-structures">
<span class="header-section-number">7</span> Shortcuts and all
allowed model structures<a class="anchor" aria-label="anchor" href="#shortcuts-and-all-allowed-model-structures"></a>
</h2>
<p>All parameters except <code>x0</code> and <code>V0</code> may be
time-varying. If time-varying, then text shortcuts cannot be used. Enter
as an array with the 3rd dimension being time. Time dimension must be 1
or equal to the number of time-steps in the data.</p>
<p>The model list elements can have the following values:</p>
<div class="section level3" number="7.1">
<h3 id="z">
<span class="header-section-number">7.1</span> <code>Z</code><a class="anchor" aria-label="anchor" href="#z"></a>
</h3>
<p>Defaults to <code>"identity"</code>. Can be a text string,
<code>"identity"</code>, <code>"unconstrained"</code>,
<code>"diagonal and unequal"</code>, <code>"diagonal and equal"</code>,
<code>"equalvarcov"</code>, or <code>"onestate"</code>, or a length
<span class="math inline">\(n\)</span> vector of factors specifying
which of the <span class="math inline">\(m\)</span> hidden state time
series correspond to which of the n observation time series. May be
specified as a <span class="math inline">\(n \times m\)</span> list
matrix for general specification of both fixed and shared elements
within the matrix. May also be specified as a numeric <span class="math inline">\(n \times m\)</span> matrix to use a custom fixed
<span class="math inline">\(\mbox{$\mathbf Z$}\)</span>.
<code>"onestate"</code> gives a <span class="math inline">\(n \times
1\)</span> matrix of 1s. The text shortcuts all specify <span class="math inline">\(n \times n\)</span> matrices.</p>
</div>
<div class="section level3" number="7.2">
<h3 id="b">
<span class="header-section-number">7.2</span> <code>B</code><a class="anchor" aria-label="anchor" href="#b"></a>
</h3>
<p>Defaults to <code>"identity"</code>. Can be a text string,
<code>"identity"</code>, <code>"unconstrained"</code>,
<code>"diagonal and unequal"</code>, <code>"diagonal and equal"</code>,
<code>"equalvarcov"</code>, <code>"zero"</code>. Can also be specified
as a list matrix for general specification of both fixed and shared
elements within the matrix. May also be specified as a numeric <span class="math inline">\(m \times m\)</span> matrix to use custom fixed
<span class="math inline">\(\mbox{$\mathbf B$}\)</span>, but in this
case all the eigenvalues of <span class="math inline">\(\mbox{$\mathbf
B$}\)</span> must fall in the unit circle.</p>
</div>
<div class="section level3" number="7.3">
<h3 id="u-and-x0">
<span class="header-section-number">7.3</span> <code>U</code> and
<code>x0</code><a class="anchor" aria-label="anchor" href="#u-and-x0"></a>
</h3>
<p>Defaults to <code>"unequal"</code>. Can be a text string,
<code>"unconstrained"</code>, <code>"equal"</code>,
<code>"unequal"</code> or <code>"zero"</code>. May be specified as a
<span class="math inline">\(m \times 1\)</span> list matrix for general
specification of both fixed and shared elements within the matrix. May
also be specified as a numeric <span class="math inline">\(m \times
1\)</span> matrix to use a custom fixed <span class="math inline">\(\mbox{$\mathbf U$}\)</span> or <span class="math inline">\(\boldsymbol{x}_0\)</span>.</p>
</div>
<div class="section level3" number="7.4">
<h3 id="a">
<span class="header-section-number">7.4</span> <code>A</code><a class="anchor" aria-label="anchor" href="#a"></a>
</h3>
<p>Defaults to <code>"scaling"</code>. Can be a text string,
<code>"scaling"</code> ,<code>"unconstrained"</code>,
<code>"equal"</code>, “unequal” or “zero”. May be specified as a n x 1
list matrix for general specification of both fixed and shared elements
within the matrix. May also be specified as a numeric <span class="math inline">\(n \times 1\)</span> matrix to use a custom fixed
<span class="math inline">\(\mbox{$\mathbf A$}\)</span>. Care must be
taken so that the model is not under-constrained and unsolvable model.
The default, <code>"scaling"</code>, only applies to <span class="math inline">\(\mbox{$\mathbf Z$}\)</span> matrices that are
design matrices (only 1s and 0s and all rows sum to 1). When a column in
<span class="math inline">\(\mbox{$\mathbf Z$}\)</span> has multiple 1s,
the first row in the <span class="math inline">\(\mbox{$\mathbf
A$}\)</span> matrix associated with those <span class="math inline">\(\mbox{$\mathbf Z$}\)</span> rows is 0 and the
other associated <span class="math inline">\(\mbox{$\mathbf A$}\)</span>
rows have an estimated value. This treats <span class="math inline">\(\mbox{$\mathbf A$}\)</span> as an intercept where
one intercept for each <span class="math inline">\(\boldsymbol{x}\)</span> (hidden state) is fixed at
0 and any other intercepts associated with that <span class="math inline">\(\boldsymbol{x}\)</span> have an estimated
intercept. This ensures a solvable model when <span class="math inline">\(\mbox{$\mathbf Z$}\)</span> is a design
matrix.</p>
</div>
<div class="section level3" number="7.5">
<h3 id="q-r-and-v0">
<span class="header-section-number">7.5</span> <code>Q</code>,
<code>R</code> and <code>V0</code><a class="anchor" aria-label="anchor" href="#q-r-and-v0"></a>
</h3>
<p>Can be a text string, <code>"identity"</code>,
<code>"unconstrained"</code>, <code>"diagonal and unequal"</code>,
<code>"diagonal and equal"</code>, <code>"equalvarcov"</code>, “zero”.
May be specified as a list matrix for general specification of both
fixed and shared elements within the matrix. May also be specified as a
numeric matrix to use a custom fixed matrix.</p>
<p><code>V0</code> defaults to <code>"zero"</code>, which means that
<span class="math inline">\(\boldsymbol{x}_0\)</span> is treated as an
estimated parameter.</p>
</div>
<div class="section level3" number="7.6">
<h3 id="d-and-c">
<span class="header-section-number">7.6</span> <code>D</code> and
<code>C</code><a class="anchor" aria-label="anchor" href="#d-and-c"></a>
</h3>
<p>Defaults to <code>"zero"</code> or if no covariates, defaults to
<code>"unconstrained"</code>. Can also be any of the options available
for the variance matrices.</p>
</div>
<div class="section level3" number="7.7">
<h3 id="d-and-c-1">
<span class="header-section-number">7.7</span> <code>d</code> and
<code>c</code><a class="anchor" aria-label="anchor" href="#d-and-c-1"></a>
</h3>
<p>Defaults to <code>"zero"</code>. Numeric matrix. No missing values
allowed. Must have 1 column or the same number of columns as the data,
The numbers of rows in must match the corresponding <span class="math inline">\(\mbox{$\mathbf D$}\)</span> or <span class="math inline">\(\mbox{$\mathbf C$}\)</span> matrix.</p>
</div>
<div class="section level3" number="7.8">
<h3 id="g-and-h">
<span class="header-section-number">7.8</span> <code>G</code> and
<code>H</code><a class="anchor" aria-label="anchor" href="#g-and-h"></a>
</h3>
<p>Defaults to <code>"identity"</code>. Can be specified as a numeric
matrix or array for time-varying cases. Size must match the
corresponding <span class="math inline">\(\mbox{$\mathbf Q$}\)</span> or
<span class="math inline">\(\mbox{$\mathbf R$}\)</span> matrix.</p>
</div>
</div>
<div class="section level2" number="8">
<h2 id="covariates-linear-constraints-and-time-varying-parameters">
<span class="header-section-number">8</span> Covariates, Linear
constraints and time-varying parameters<a class="anchor" aria-label="anchor" href="#covariates-linear-constraints-and-time-varying-parameters"></a>
</h2>
<div class="section level3" number="8.1">
<h3 id="covariates">
<span class="header-section-number">8.1</span> Covariates<a class="anchor" aria-label="anchor" href="#covariates"></a>
</h3>
<p>Inputs, aka covariates, are in <span class="math inline">\(\mbox{$\mathbf c$}\)</span> and <span class="math inline">\(\mbox{$\mathbf d$}\)</span>. The are passed in via
the model list and must be a numeric matrix (no missing values). <span class="math inline">\(\mbox{$\mathbf C$}\)</span> and <span class="math inline">\(\mbox{$\mathbf D$}\)</span> are the estimated
parameters, aka covariate effects.</p>
<p>Let’s say you have temperature data and you want to include a linear
effect of temperature that is different for each <span class="math inline">\(\boldsymbol{x}\)</span> time series:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">50</span><span class="op">)</span>, <span class="fl">0.1</span><span class="op">)</span>,nrow<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">C1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"temp1"</span>,<span class="st">"temp2"</span><span class="op">)</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">model.list</span><span class="op">$</span><span class="va">C</span> <span class="op">&lt;-</span> <span class="va">C1</span></span>
<span><span class="va">model.list</span><span class="op">$</span><span class="va">c</span> <span class="op">&lt;-</span> <span class="va">temp</span></span></code></pre></div>
<p>Fit as normal:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MARSS.html">MARSS</a></span><span class="op">(</span><span class="va">y</span>, model<span class="op">=</span><span class="va">model.list</span>, method<span class="op">=</span><span class="st">"BFGS"</span><span class="op">)</span></span></code></pre></div>
<p>A seasonal effect can be easily included via sine/cosine pairs. The
<code>fourier()</code> function in the {forecast} package simplifies
this. You will need to make your data into a ts/mts object.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, frequency <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="co"># requires time down the rows</span></span>
<span><span class="va">fcov</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/fourier.html" class="external-link">fourier</a></span><span class="op">(</span><span class="va">yts</span>,<span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Registered S3 method overwritten by 'quantmod':</span></span>
<span><span class="co">##   method            from</span></span>
<span><span class="co">##   as.zoo.data.frame zoo</span></span></code></pre>
<p>If you want a factor effect, then you can use the
<code>seasonaldummy()</code> function in {forecast}</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, frequency <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="co"># monthly data</span></span>
<span><span class="va">mcov</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/seasonaldummy.html" class="external-link">seasonaldummy</a></span><span class="op">(</span><span class="va">yts</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># month factor</span></span></code></pre></div>
</div>
<div class="section level3" number="8.2">
<h3 id="linear-constraints">
<span class="header-section-number">8.2</span> Linear
constraints<a class="anchor" aria-label="anchor" href="#linear-constraints"></a>
</h3>
<p>Your model can have simple linear constraints within all the
parameters except <span class="math inline">\(\mbox{$\mathbf
Q$}\)</span>, <span class="math inline">\(\mbox{$\mathbf R$}\)</span>
and <span class="math inline">\(\boldsymbol{\Lambda}\)</span>. For
example <span class="math inline">\(1+2a-3b\)</span> is a linear
constraint. When entering this value for you matrix, you specify this as
<code>"1+2*a+-3*b"</code>. NOTE: <span class="math inline">\(+\)</span>’s join parts so <code>+-3*b</code> to
specify <span class="math inline">\(-3b\)</span>. Anything after
<code>*</code> is a parameter. So <code>1*1</code> has a parameter
called <code>"1"</code>. Example, let’s change the <span class="math inline">\(\mbox{$\mathbf B$}\)</span> and <span class="math inline">\(\mbox{$\mathbf Q$}\)</span> matrices in the
previous model to: <span class="math display">\[\begin{equation*}
\mbox{$\mathbf B$}= \begin{bmatrix}b-0.1&amp;0\\
0&amp;b+0.1\end{bmatrix}\quad
\mbox{$\mathbf Q$}= \begin{bmatrix}1&amp;0\\ 0&amp;1\end{bmatrix}\quad
\mbox{$\mathbf Z$}= \begin{bmatrix}z_1-z_2&amp;2 z_1\\ 0&amp;z_1\\
z_2&amp;0\end{bmatrix}
\end{equation*}\]</span> <em><span class="math inline">\(\mbox{$\mathbf
Q$}\)</span> is fixed because <span class="math inline">\(\mbox{$\mathbf
Z$}\)</span> is estimated and estimating both creates a statistically
confounded model (both scale the variance of <span class="math inline">\(\boldsymbol{x}\)</span>).</em></p>
<p>This would be specified as (notice <code>"1*z1+-1*z2"</code> for
<code>z1-z2</code>):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">B1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"-0.1+1*b"</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="st">"0.1+1*b"</span><span class="op">)</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">Q1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">Z1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"1*z1+-1*z2"</span>,<span class="fl">0</span>,<span class="st">"z2"</span>,<span class="st">"2*z1"</span>,<span class="st">"z1"</span>,<span class="fl">0</span><span class="op">)</span>,<span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">model.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>B<span class="op">=</span><span class="va">B1</span>,U<span class="op">=</span><span class="va">U1</span>,Q<span class="op">=</span><span class="va">Q1</span>,Z<span class="op">=</span><span class="va">Z1</span>,A<span class="op">=</span><span class="va">A1</span>,R<span class="op">=</span><span class="va">R1</span>,x0<span class="op">=</span><span class="va">pi1</span>,V0<span class="op">=</span><span class="va">V1</span>,tinitx<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>Fit as usual:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MARSS.html">MARSS</a></span><span class="op">(</span><span class="va">y</span>, model<span class="op">=</span><span class="va">model.list</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="8.3">
<h3 id="time-varying-parameters">
<span class="header-section-number">8.3</span> Time-varying
parameters<a class="anchor" aria-label="anchor" href="#time-varying-parameters"></a>
</h3>
<p>The default model form allows you to pass in a 3-D array for a
time-varying parameter (<span class="math inline">\(T\)</span> is the
number of time-steps in your data and is the 3rd dimension in the
array):<br><span class="math display">\[\begin{equation}
\begin{gathered}
\boldsymbol{x}_t = \mbox{$\mathbf B$}_t\boldsymbol{x}_{t-1} +
\mbox{$\mathbf U$}_t + \mbox{$\mathbf C$}_t\mbox{$\mathbf c$}_t +
\mbox{$\mathbf G$}_t\boldsymbol{w}_t, \quad
\boldsymbol{W}_t \sim \,\textup{\textrm{MVN}}(0,\mbox{$\mathbf Q$}_t)\\
\boldsymbol{y}_t = \mbox{$\mathbf Z$}_t\boldsymbol{x}_t + \mbox{$\mathbf
A$}_t + \mbox{$\mathbf D$}_t\mbox{$\mathbf d$}_t + \mbox{$\mathbf
H$}_t\boldsymbol{v}_t, \quad
\boldsymbol{V}_t \sim \,\textup{\textrm{MVN}}(0,\mbox{$\mathbf R$}_t)\\
\boldsymbol{x}_{t_0} \sim
\,\textup{\textrm{MVN}}(\boldsymbol{\xi},\boldsymbol{\Lambda})
\end{gathered}
\end{equation}\]</span> Zeros are allowed on the diagonals of <span class="math inline">\(\mbox{$\mathbf Q$}\)</span>, <span class="math inline">\(\mbox{$\mathbf R$}\)</span> and <span class="math inline">\(\boldsymbol{\Lambda}\)</span>. NOTE(!!), the time
indexing. Make sure you enter your arrays such that the correct
parameter (or input) at time <span class="math inline">\(t\)</span>
lines up with <span class="math inline">\(\boldsymbol{x}_t\)</span>;
e.g., it is common for state equations to have <span class="math inline">\(\mbox{$\mathbf B$}_{t-1}\)</span> lined up with
<span class="math inline">\(\boldsymbol{x}_t\)</span> so you might need
to enter the <span class="math inline">\(\mbox{$\mathbf B$}\)</span>
array such that your <span class="math inline">\(\mbox{$\mathbf
B$}_{t-1}\)</span> is entered at <code>Bt[,,t]</code> in your code.</p>
<p>The length of the 3rd dimension must be the same as your data. For
example, say in your mean-reverting random walk model (the example on
the first page) you wanted <span class="math inline">\(\mbox{$\mathbf
B$}(2,2)\)</span> to be one value before <span class="math inline">\(t=20\)</span> and another value after but <span class="math inline">\(\mbox{$\mathbf B$}(1,1)\)</span> to be time
constant. You can pass in the following:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">B1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="va">TT</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">B1</span><span class="op">[</span>,,<span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"b"</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="st">"b_1"</span><span class="op">)</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">B1</span><span class="op">[</span>,,<span class="fl">21</span><span class="op">:</span><span class="va">TT</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"b"</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="st">"b_2"</span><span class="op">)</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>Notice the specification is one-to-one to your <span class="math inline">\(\mbox{$\mathbf B$}_t\)</span> matrices on
paper.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Elizabeth Eli Holmes, Eric J. Ward, Mark D. Scheuerell, Kellie Wills.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
