<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This is the main function for fitting multivariate autoregressive state-space (MARSS) models with linear constraints.  Scroll down to the bottom to see some short examples.  To open a guide to show you how to get started quickly, type RShowDoc(&quot;Quick_Start&quot;,package=&quot;MARSS&quot;).  To open the MARSS User Guide from the command line, type RShowDoc(&quot;UserGuide&quot;,package=&quot;MARSS&quot;). To get an overview of the package and all its main functions and how to get output (parameter estimates, fitted values, residuals, Kalmin filter or smoother output, or plots), go to MARSS-package. If MARSS() is throwing errors or warnings that you don't understand, try the Troubleshooting section of the user guide or type MARSSinfo() at the command line.  
The default MARSS model form is &quot;marxss&quot;, which is Multivariate Auto-Regressive(1) eXogenous inputs State-Space model:
$$\mathbf{x}_{t} = \mathbf{B}_t \mathbf{x}_{t-1} + \mathbf{u}_t + \mathbf{C}_t \mathbf{c}_t + \mathbf{G}_t \mathbf{w}_t, \textrm{ where } \mathbf{W}_t \sim \textrm{MVN}(0,\mathbf{Q}_t)$$
$$\mathbf{y}_t = \mathbf{Z}_t \mathbf{x}_t + \mathbf{a}_t + \mathbf{D}_t \mathbf{d}_t + \mathbf{H}_t \mathbf{v}_t, \textrm{ where } \mathbf{V}_t \sim \textrm{MVN}(0,\mathbf{R}_t)$$
$$\mathbf{X}_1 \sim \textrm{MVN}(\mathbf{x0}, \mathbf{V0}) \textrm{ or } \mathbf{X}_0 \sim \textrm{MVN}(\mathbf{x0}, \mathbf{V0}) $$
The parameters are everything except \(\mathbf{x}\), \(\mathbf{y}\), \(\mathbf{v}\), \(\mathbf{w}\), \(\mathbf{c}\) and \(\mathbf{d}\). \(\mathbf{y}\) are data (missing values allowed). \(\mathbf{c}\) and \(\mathbf{d}\) are inputs (no missing values allowed). All parameters (except \(\mathbf{x0}\) and \(\mathbf{V0}\)) can be time-varying but by default, all are time-constant (and the MARSS equation is generally written without the \(t\) subscripts on the parameter matrices). All parameters can be zero, including the variance matrices.
The parameter matrices can have fixed values and linear constraints. This is an example of a 3x3 matrix with linear constraints. All matrix elements can be written as a linear function of \(a\), \(b\), and \(c\):
$$\left[\begin{array}{c c c} a+2b &amp;amp; 1 &amp;amp; a\\ 1+3a+b &amp;amp; 0 &amp;amp; b \\ 0 &amp;amp; -2 &amp;amp; c\end{array}\right]$$
Values such as \(a b\) or \(a^2\) or \(log(a)\) are not linear constraints."><title>Fit a MARSS Model via Maximum-Likelihood Estimation — MARSS • MARSS</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><script src="../extra.js"></script><meta property="og:title" content="Fit a MARSS Model via Maximum-Likelihood Estimation — MARSS"><meta property="og:description" content="This is the main function for fitting multivariate autoregressive state-space (MARSS) models with linear constraints.  Scroll down to the bottom to see some short examples.  To open a guide to show you how to get started quickly, type RShowDoc(&quot;Quick_Start&quot;,package=&quot;MARSS&quot;).  To open the MARSS User Guide from the command line, type RShowDoc(&quot;UserGuide&quot;,package=&quot;MARSS&quot;). To get an overview of the package and all its main functions and how to get output (parameter estimates, fitted values, residuals, Kalmin filter or smoother output, or plots), go to MARSS-package. If MARSS() is throwing errors or warnings that you don't understand, try the Troubleshooting section of the user guide or type MARSSinfo() at the command line.  
The default MARSS model form is &quot;marxss&quot;, which is Multivariate Auto-Regressive(1) eXogenous inputs State-Space model:
$$\mathbf{x}_{t} = \mathbf{B}_t \mathbf{x}_{t-1} + \mathbf{u}_t + \mathbf{C}_t \mathbf{c}_t + \mathbf{G}_t \mathbf{w}_t, \textrm{ where } \mathbf{W}_t \sim \textrm{MVN}(0,\mathbf{Q}_t)$$
$$\mathbf{y}_t = \mathbf{Z}_t \mathbf{x}_t + \mathbf{a}_t + \mathbf{D}_t \mathbf{d}_t + \mathbf{H}_t \mathbf{v}_t, \textrm{ where } \mathbf{V}_t \sim \textrm{MVN}(0,\mathbf{R}_t)$$
$$\mathbf{X}_1 \sim \textrm{MVN}(\mathbf{x0}, \mathbf{V0}) \textrm{ or } \mathbf{X}_0 \sim \textrm{MVN}(\mathbf{x0}, \mathbf{V0}) $$
The parameters are everything except \(\mathbf{x}\), \(\mathbf{y}\), \(\mathbf{v}\), \(\mathbf{w}\), \(\mathbf{c}\) and \(\mathbf{d}\). \(\mathbf{y}\) are data (missing values allowed). \(\mathbf{c}\) and \(\mathbf{d}\) are inputs (no missing values allowed). All parameters (except \(\mathbf{x0}\) and \(\mathbf{V0}\)) can be time-varying but by default, all are time-constant (and the MARSS equation is generally written without the \(t\) subscripts on the parameter matrices). All parameters can be zero, including the variance matrices.
The parameter matrices can have fixed values and linear constraints. This is an example of a 3x3 matrix with linear constraints. All matrix elements can be written as a linear function of \(a\), \(b\), and \(c\):
$$\left[\begin{array}{c c c} a+2b &amp;amp; 1 &amp;amp; a\\ 1+3a+b &amp;amp; 0 &amp;amp; b \\ 0 &amp;amp; -2 &amp;amp; c\end{array}\right]$$
Values such as \(a b\) or \(a^2\) or \(log(a)\) are not linear constraints."><meta property="og:image" content="https://atsa-es.github.io/MARSS/logo.png"><!-- mathjax --><script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js">
</script><!--
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
--><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MARSS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.11.9</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/atsa-es/MARSS/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Fit a MARSS Model via Maximum-Likelihood Estimation</h1>
      
      <div class="d-none name"><code>MARSS.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This is the main function for fitting multivariate autoregressive state-space (MARSS) models with linear constraints.  Scroll down to the bottom to see some short examples.  To open a guide to show you how to get started quickly, type <code>RShowDoc("Quick_Start",package="MARSS")</code>.  To open the MARSS User Guide from the command line, type <code>RShowDoc("UserGuide",package="MARSS")</code>. To get an overview of the package and all its main functions and how to get output (parameter estimates, fitted values, residuals, Kalmin filter or smoother output, or plots), go to <code><a href="MARSS-package.html">MARSS-package</a></code>. If <code>MARSS()</code> is throwing errors or warnings that you don't understand, try the Troubleshooting section of the user guide or type <code><a href="MARSSinfo.html">MARSSinfo</a>()</code> at the command line.</p>  
<p>The default MARSS model form is "marxss", which is Multivariate Auto-Regressive(1) eXogenous inputs State-Space model:
$$\mathbf{x}_{t} = \mathbf{B}_t \mathbf{x}_{t-1} + \mathbf{u}_t + \mathbf{C}_t \mathbf{c}_t + \mathbf{G}_t \mathbf{w}_t, \textrm{ where } \mathbf{W}_t \sim \textrm{MVN}(0,\mathbf{Q}_t)$$
$$\mathbf{y}_t = \mathbf{Z}_t \mathbf{x}_t + \mathbf{a}_t + \mathbf{D}_t \mathbf{d}_t + \mathbf{H}_t \mathbf{v}_t, \textrm{ where } \mathbf{V}_t \sim \textrm{MVN}(0,\mathbf{R}_t)$$
$$\mathbf{X}_1 \sim \textrm{MVN}(\mathbf{x0}, \mathbf{V0}) \textrm{ or } \mathbf{X}_0 \sim \textrm{MVN}(\mathbf{x0}, \mathbf{V0}) $$
The parameters are everything except \(\mathbf{x}\), \(\mathbf{y}\), \(\mathbf{v}\), \(\mathbf{w}\), \(\mathbf{c}\) and \(\mathbf{d}\). \(\mathbf{y}\) are data (missing values allowed). \(\mathbf{c}\) and \(\mathbf{d}\) are inputs (no missing values allowed). All parameters (except \(\mathbf{x0}\) and \(\mathbf{V0}\)) can be time-varying but by default, all are time-constant (and the MARSS equation is generally written without the \(t\) subscripts on the parameter matrices). All parameters can be zero, including the variance matrices.</p>
<p>The parameter matrices can have fixed values and linear constraints. This is an example of a 3x3 matrix with linear constraints. All matrix elements can be written as a linear function of \(a\), \(b\), and \(c\):
$$\left[\begin{array}{c c c} a+2b &amp; 1 &amp; a\\ 1+3a+b &amp; 0 &amp; b \\ 0 &amp; -2 &amp; c\end{array}\right]$$</p>
<p>Values such as \(a b\) or \(a^2\) or \(log(a)\) are not linear constraints.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">MARSS</span><span class="op">(</span><span class="va">y</span>, </span>
<span>    model <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>    inits <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>    miss.value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>, </span>
<span>    method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"kem"</span>, <span class="st">"BFGS"</span>, <span class="st">"TMB"</span>, <span class="st">"BFGS_TMB"</span>, <span class="st">"nlminb_TMB"</span><span class="op">)</span>, </span>
<span>    form <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"marxss"</span>, <span class="st">"dfa"</span>, <span class="st">"marss"</span><span class="op">)</span>, </span>
<span>    fit <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>    silent <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>    control <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>    fun.kf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MARSSkfas"</span>, <span class="st">"MARSSkfss"</span><span class="op">)</span>, </span>
<span>    <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    

<p>The default settings for the optional arguments are set in <code>MARSSsettings.R</code> and are given below in the details section. For form specific defaults see the form help file (e.g. <code><a href="MARSS_marxss.html">MARSS.marxss</a></code> or <code><a href="MARSS_dfa.html">MARSS.dfa</a></code>).</p>
<dl><dt>y</dt>
<dd><p>A n x T matrix of n time series over T time steps. Only y is required for the function. A ts object (univariate or multivariate) can be used and this will be converted to a matrix with time in the columns.</p></dd>

  <dt>inits</dt>
<dd><p>A list with the same form as the list outputted by <code>coef(fit)</code> that specifies initial values for the parameters.  See also <code><a href="MARSS_marxss.html">MARSS.marxss</a></code>.</p></dd>

  <dt>model</dt>
<dd><p>Model specification using a list of parameter matrix text shortcuts or matrices. See Details and <code><a href="MARSS_marxss.html">MARSS.marxss</a></code> for the default form. Or better yet open the Quick Start Guide <code>RShowDoc("Quick_Start",package="MARSS")</code>.</p></dd>

  <dt>miss.value</dt>
<dd><p>Deprecated.  Denote missing values by NAs in your data.</p></dd>

  <dt>method</dt>
<dd><p>Estimation method. MARSS provides an EM algorithm (<code>method="kem"</code>) (see <code><a href="MARSSkem.html">MARSSkem</a></code>) and the BFGS algorithm (<code>method="BFGS"</code>) (see <code><a href="MARSSoptim.html">MARSSoptim</a></code>).</p></dd>

  <dt>form</dt>
<dd><p>The equation form used in the <code>MARSS()</code> call.  The default is "marxss". See <code><a href="MARSS_marxss.html">MARSS.marxss</a></code> or <code><a href="MARSS_dfa.html">MARSS.dfa</a></code>.</p></dd>

  <dt>fit</dt>
<dd><p>TRUE/FALSE Whether to fit the model to the data. If FALSE, a <code><a href="marssMLE-class.html">marssMLE</a></code> object with only the model is returned.</p></dd>

  <dt>silent</dt>
<dd><p>Setting to TRUE(1) suppresses printing of full error messages, warnings, progress bars and convergence information. Setting to FALSE(0) produces error output. Setting silent=2 will produce more verbose error messages and progress information.</p></dd>

    <dt>fun.kf</dt>
<dd><p>What Kalman filter function to use.  MARSS has two: <code><a href="MARSSkf.html">MARSSkfas</a>()</code> which is based on the Kalman filter in the <a href="https://cran.r-project.org/package=KFAS" class="external-link">KFAS</a> package based on Koopman and Durbin and <code><a href="MARSSkf.html">MARSSkfss</a>()</code> which is a native R implementation of the Kalman filter and smoother in Shumway and Stoffer. The KFAS filter is much faster.  <code><a href="MARSSkf.html">MARSSkfas</a>()</code> modifies the input and output in order to output the lag-one covariance smoother needed for the EM algorithm (per page 321 in Shumway and Stoffer (2000).</p></dd>

  <dt>control</dt>
<dd><p>Estimation options for the maximization algorithm. The typically used control options for method="kem" are below but see  <code><a href="marssMLE-class.html">marssMLE</a></code> for the full list of control options.  Note many of these are not allowed if method="BFGS"; see  <code><a href="MARSSoptim.html">MARSSoptim</a></code> for the allowed control options for this method.</p><ul><li><p><code>minit</code>   The minimum number of iterations to do in the maximization routine (if needed by method). If <code>method="kem"</code>, this is an easy way to up the iterations and see how your estimates are converging. (positive integer)</p></li>
<li><p><code>maxit</code>   Maximum number of iterations to be used in the maximization routine (if needed by method) (positive integer).</p></li>
<li><p><code>min.iter.conv.test</code> Minimum iterations to run before testing convergence via the slope of the log parameter versus log iterations.</p></li>
<li><p><code>conv.test.deltaT=9</code> Number of iterations to use for the testing convergence via the slope of the log parameter versus log iterations.</p></li>
<li><p><code>conv.test.slope.tol</code> The slope of the log parameter versus log iteration to use as the cut-off for convergence.  The default is 0.5 which is a bit high.  For final analyses, this should be set lower.  If you want to only use abstol as your convergence test, then to something very large, for example <code>conv.test.slope.tol=1000</code>.  Type <code>MARSSinfo(11)</code> to see some comments on when you might want to do this.</p></li>
<li><p><code>abstol</code> The logLik.(iter-1)-logLik.(iter) convergence tolerance for the maximization routine. To meet convergence both the abstol and slope tests must be passed.</p></li>
<li><p><code>allow.degen</code> Whether to try setting \(\mathbf{Q}\) or \(\mathbf{R}\) elements to zero if they appear to be going to zero.</p></li>
<li><p><code>trace</code> An integer specifying the level of information recorded and error-checking run during the algorithms.  <code>trace=0</code>, specifies basic error-checking and brief error-messages; <code>trace&gt;0</code> will print full error messages. In addition if trace&gt;0, the Kalman filter output will be added to the outputted <code>marssMLE</code> object.  Additional information recorded depends on the method of maximization. For the EM algorithm, a record of each parameter estimate for each EM iteration will be added.   See <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></code> for trace output details for the BFGS method.   <code>trace=-1</code> will turn off most internal error-checking and most error messages.  The internal error checks are time expensive so this can speed up model fitting.  This is particularly useful for bootstrapping and simulation studies. It is also useful if you get an error saying that <code>MARSS()</code> stops in <code><a href="MARSSkf.html">MARSSkfss</a>()</code> due to a <code><a href="https://rdrr.io/r/base/chol.html" class="external-link">chol()</a></code> call. <code><a href="MARSSkf.html">MARSSkfss()</a></code> uses matrix inversions and for some models these are unstable (high condition value). <code><a href="MARSSkf.html">MARSSkfss()</a></code> is used for error-checks and does not need to be called normally.</p></li>
<li><p><code>safe</code>  Setting <code>safe=TRUE</code> runs the Kalman smoother after each parameter update rather than running the smoother only once after updated all parameters.  The latter is faster but is not a strictly correct EM algorithm.  In most cases, <code>safe=FALSE</code> (default) will not change the fits.  If this setting does cause problems, you will know because you will see an error regarding the log-likelihood dropping and it will direct you to set <code>safe=TRUE</code>.</p></li>
</ul><p></p></dd>

    <dt>...</dt>
<dd><p>Optional arguments passed to function specified by form.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>model</code> argument specifies the structure of your model. There is a one-to-one correspondence between how you would write your model in matrix form on the whiteboard and how you specify the model for <code>MARSS()</code>.  Many different types of multivariate time-series models can be converted to the MARSS form. See the <a href="https://cran.r-project.org/package=MARSS/vignettes/UserGuide.pdf" class="external-link">User Guide</a> and <a href="https://cran.r-project.org/package=MARSS/vignettes/Quick_Start.pdf" class="external-link">Quick Start Guide</a> for examples.</p>
<p>The MARSS package has two forms for standard users: marxss and dfa.</p><dl><dt><code><a href="MARSS_marxss.html">MARSS.marxss</a></code></dt>
<dd><p>This is the default form. This is a MARSS model with (optional) inputs \(\mathbf{c}_t\) or \(\mathbf{d}_t\). Most users will want this help page.</p></dd>

<dt><code><a href="MARSS_dfa.html">MARSS.dfa</a></code></dt>
<dd><p>This is a model form to allow easier specification of models for Dynamic Factor Analysis. The \(\mathbf{Z}\) parameters has a specific form and the \(\mathbf{Q}\) is set at i.i.d (diagonal) with variance of 1.</p></dd>


</dl><p>Those looking to modify or understand the base code, should look at <code><a href="MARSS_marss.html">MARSS.marss</a></code> and 
<code><a href="MARSS_vectorized.html">MARSS.vectorized</a></code>. These describe the forms used by the base functions. The EM algorithm uses the MARSS model written in vectorized form. This form is what allows linear constraints.</p>
<p>The likelihood surface for MARSS models can be  multimodal or with strong ridges.  It is  recommended that for final analyses the estimates are checked by using a Monte Carlo initial conditions search; see the chapter on initial conditions searches in the User Guide.  This requires more computation time, but reduces the chance of the algorithm terminating at a local maximum and not reaching the true MLEs.  Also it is wise to check the EM results against the BFGS results (if possible) if there are strong ridges in the likelihood.  Such ridges seems to slow down the EM algorithm considerably and can cause the algorithm to report convergence far from the maximum-likelihood values.  EM steps up the likelihood and the convergence test is based on the rate of change of the log-likelihood in each step. Once on a strong ridge, the steps can slow dramatically.  You can force the algorithm to keep working by setting <code>minit</code>.  BFGS seems less hindered by the ridges but can be prodigiously slow for some multivariate problems.  BFGS tends to work better if you give it good initial conditions (see Examples below for how to do this).</p> 
<p>If you are working with models with time-varying parameters, it is important to notice the time-index for the parameters in the process equation (the \(\mathbf{x}\) equation).  In some formulations (e.g. in <code><a href="https://rdrr.io/pkg/KFAS/man/KFAS.html" class="external-link">KFAS</a></code>), the process equation is \(\mathbf{x}_t=\mathbf{B}_{t-1}\mathbf{x}_{t-1}+\mathbf{w}_{t-1}\) so \(\mathbf{B}_{t-1}\) goes with \(\mathbf{x}_t\) not \(\mathbf{B}_t\). Thus one needs to be careful to line up the time indices when passing in time-varying parameters to <code>MARSS()</code>.  See the User Guide for examples.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>An object of class <code><a href="marssMLE-class.html">marssMLE</a></code>.  The structure of this object is discussed below, but if you want to know how to get specific output (like residuals, coefficients, smoothed states, confidence intervals, etc), see <code><a href="print_marssMLE.html">print.marssMLE</a>()</code>, <code><a href="tidy_marssMLE.html">tidy.marssMLE</a>()</code>, <code><a href="MARSSresiduals.html">MARSSresiduals</a>()</code> and <code><a href="plot_marssMLE.html">plot.marssMLE</a>()</code>.</p>
  

<p>The outputted <code><a href="marssMLE-class.html">marssMLE</a></code> object has the following components:</p>
<dl><dt>model</dt>
<dd><p>MARSS model specification. It is a <code><a href="marssMODEL-class.html">marssMODEL</a></code> object in the form specified by the user in the <code>MARSS()</code> call.  This is used by print functions so that the user sees the expected form.</p></dd>

  <dt>marss</dt>
<dd><p>The <code><a href="marssMODEL-class.html">marssMODEL</a></code> object in marss form. This form is needed for all the internal algorithms, thus is a required part of a <code><a href="marssMLE-class.html">marssMLE</a></code> object.</p></dd>

  <dt>call</dt>
<dd><p>All the information passed in in the <code>MARSS()</code> call.</p></dd>

  <dt>start</dt>
<dd><p>List with specifying initial values that were used for each parameter matrix.</p></dd>
 
  <dt>control</dt>
<dd><p>A list of estimation options, as specified by arguments <code>control</code>.</p></dd>

  <dt>method</dt>
<dd><p>Estimation method.</p></dd>

</dl><p>If <code>fit=TRUE</code>, the following are also added to the <code><a href="marssMLE-class.html">marssMLE</a></code> object.
  If <code>fit=FALSE</code>, a <code><a href="marssMLE-class.html">marssMLE</a></code> object ready for fitting via the specified <code>method</code> is returned.</p>
<dl><dt>par</dt>
<dd><p>A list of estimated parameter values in marss form. Use <code><a href="print_marssMLE.html">print</a>()</code>, <code><a href="tidy_marssMLE.html">tidy</a>()</code> or <code><a href="coef_marssMLE.html">coef</a>()</code> for outputing the model estimates in the <code>MARSS()</code> call (e.g. the default "marxss" form).</p></dd>

  <dt>states</dt>
<dd><p>The expected value of \(\mathbf{X}\) conditioned on all the data, i.e. smoothed states.</p></dd>

  <dt>states.se</dt>
<dd><p>The standard errors of the expected value of \(\mathbf{X}\).</p></dd>

  <dt>ytT</dt>
<dd><p>The expected value of \(\mathbf{Y}\) conditioned on all the data.  Note this is just \(y\) for those \(y\) that are not missing.</p></dd>

  <dt>ytT.se</dt>
<dd><p>The standard errors of the expected value of \(\mathbf{Y}\). Note this is 0 for any non-missing \(y\).</p></dd>

  <dt>numIter</dt>
<dd><p>Number of iterations required for convergence.</p></dd>

  <dt>convergence</dt>
<dd><p>Convergence status. 0 means converged successfully, 3 means all parameters were fixed (so model did not need to be fit) and -1 means call was made with <code>fit=FALSE</code> and parameters were not fixed (thus no <code>$par</code> element and Kalman filter/smoother cannot be run).  Anything else is a warning or error. 2 means the <code><a href="marssMLE-class.html">marssMLE</a></code> object has an error; the object is returned so you can debug it.  The other numbers are errors during fitting.  The error code depends on the fitting method.  See <code><a href="MARSSkem.html">MARSSkem</a></code> and <code><a href="MARSSoptim.html">MARSSoptim</a></code>.</p></dd>

  <dt>logLik</dt>
<dd><p>Log-likelihood.</p></dd>

  <dt>AIC</dt>
<dd><p>Akaike's Information Criterion.</p></dd>

  <dt>AICc</dt>
<dd><p>Sample size corrected AIC.</p></dd>

</dl><p>If <code>control$trace</code> is set to 1 or greater, the following are also added to the <code><a href="marssMLE-class.html">marssMLE</a></code> object.</p>
<dl><dt>kf</dt>
<dd><p>A list containing Kalman filter/smoother output from <code><a href="MARSSkf.html">MARSSkf</a>()</code>.  This is not normally added to a <code><a href="marssMLE-class.html">marssMLE</a></code> object since it is verbose, but can be added using <code><a href="MARSSkf.html">MARSSkf</a>()</code>.</p></dd>

  <dt>Ey</dt>
<dd><p>A list containing output from <code><a href="MARSShatyt.html">MARSShatyt</a></code>. This isn't normally added to a <code><a href="marssMLE-class.html">marssMLE</a></code> object since it is verbose, but can be computed using <code><a href="MARSShatyt.html">MARSShatyt</a>()</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>The MARSS User Guide:  Holmes, E. E., E. J. Ward, and M. D. Scheuerell (2012) Analysis of multivariate time-series using the MARSS package. NOAA Fisheries, Northwest Fisheries Science
Center, 2725 Montlake Blvd E., Seattle, WA 98112   Type <code>RShowDoc("UserGuide",package="MARSS")</code> to open a copy.</p>
<p>Holmes, E. E. (2012).  Derivation of the EM algorithm for constrained and unconstrained multivariate autoregressive state-space (MARSS) models.  Technical Report. arXiv:1302.3919 [stat.ME]</p>
<p>Holmes, E. E., E. J. Ward and K. Wills. (2012) MARSS: Multivariate autoregressive state-space models for analyzing time-series data. R Journal 4: 11-19.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Eli Holmes, Eric Ward and Kellie Wills, NOAA, Seattle, USA.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="marssMLE-class.html">marssMLE</a></code>, <code><a href="MARSSkem.html">MARSSkem</a>()</code>, <code><a href="MARSSoptim.html">MARSSoptim</a>()</code>, <code><a href="MARSSkf.html">MARSSkf</a>()</code>, <code><a href="MARSS-package.html">MARSS-package</a></code>, <code><a href="print_marssMLE.html">print.marssMLE</a>()</code>, <code><a href="plot_marssMLE.html">plot.marssMLE</a>()</code>, <code><a href="print_marssMODEL.html">print.marssMODEL</a>()</code>, <code><a href="MARSS_marxss.html">MARSS.marxss</a>()</code>, <code><a href="MARSS_dfa.html">MARSS.dfa</a>()</code>,  <code><a href="fitted_marssMLE.html">fitted</a>()</code>, <code><a href="residuals_marssMLE.html">residuals</a>()</code>, <code><a href="MARSSresiduals.html">MARSSresiduals</a>()</code>, <code><a href="predict_marssMLE.html">predict</a>()</code>, <code><a href="tsSmooth_marssMLE.html">tsSmooth</a>()</code>,
<code><a href="tidy_marssMLE.html">tidy</a>()</code>, <code><a href="coef_marssMLE.html">coef</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">harborSealWA</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span>, <span class="op">]</span> <span class="co"># remove the year row</span></span></span>
<span class="r-in"><span><span class="co"># fit a model with 1 hidden state and 3 observation time series</span></span></span>
<span class="r-in"><span><span class="va">kemfit</span> <span class="op">&lt;-</span> <span class="fu">MARSS</span><span class="op">(</span><span class="va">dat</span>, model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  Z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  R <span class="op">=</span> <span class="st">"diagonal and equal"</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Success! abstol and log-log tests passed at 20 iterations.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Alert: conv.test.slope.tol is 0.5.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Test with smaller values (&lt;0.1) to ensure convergence.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MARSS fit is</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimation method: kem </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimation converged in 20 iterations. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Log-likelihood: 15.70271 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: -19.40541   AICc: -17.57932   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A.SJI    0.79691</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A.EBays  0.27579</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> R.diag   0.02236</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U.U      0.06075</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.Q      0.00909</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.x0    6.10491</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Initial states (x0) defined at t=0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Standard errors have not been calculated. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Use MARSSparamCIs to compute CIs and bias estimates.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="va">kemfit</span><span class="op">$</span><span class="va">model</span> <span class="co"># This gives a description of the model</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model form is marxss. Model Structure is</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> m: 1 state process(es) named X1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> n: 3 observation time series named SJF SJI EBays</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Z :  design matrix with rows: X1 X1 X1 (3 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A :  see summary() (3 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> R :  diagonal and equal (3 x 3) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> B :  fixed and all one (1 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U :  scalar (1 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q :  scalar (1 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0 :  scalar (1 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> V0 :  fixed and zero (1 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D :  fixed and zero (3 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> C :  fixed and zero (1 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> d :  fixed and zero (1 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c :  fixed and zero (1 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> G :  fixed and all one (1 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> H :  identity (3 x 3) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> L :  fixed and all one (1 x 1) </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">kemfit</span><span class="op">$</span><span class="va">model</span><span class="op">)</span> <span class="co"># same as kemfit$model</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model form is marxss. Model Structure is</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> m: 1 state process(es) named X1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> n: 3 observation time series named SJF SJI EBays</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Z :  design matrix with rows: X1 X1 X1 (3 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A :  see summary() (3 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> R :  diagonal and equal (3 x 3) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> B :  fixed and all one (1 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U :  scalar (1 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q :  scalar (1 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0 :  scalar (1 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> V0 :  fixed and zero (1 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D :  fixed and zero (3 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> C :  fixed and zero (1 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> d :  fixed and zero (1 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c :  fixed and zero (1 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> G :  fixed and all one (1 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> H :  identity (3 x 3) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> L :  fixed and all one (1 x 1) </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">kemfit</span><span class="op">$</span><span class="va">model</span><span class="op">)</span> <span class="co"># This shows the model structure</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model Structure is</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> m: 1 state process(es)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> n: 3 observation time series</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Z</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       X1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> SJF    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> SJI    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> EBays  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $A</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Y      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> SJF   0      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> SJI   "SJI"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> EBays "EBays"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $R</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       SJF    SJI    EBays </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> SJF   "diag" 0      0     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> SJI   0      "diag" 0     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> EBays 0      0      "diag"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $B</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    X1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $U</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    X  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1 "U"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $Q</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    X1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1 "Q"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $x0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    X   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1 "x0"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $V0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    X1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1  0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $D</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $C</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $d</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $c</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $G</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $H</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    1    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]    0    1    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]    0    0    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $L</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $tinitx</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># add CIs to a marssMLE object</span></span></span>
<span class="r-in"><span><span class="co"># default uses an estimated Hessian matrix</span></span></span>
<span class="r-in"><span><span class="va">kem.with.hess.CIs</span> <span class="op">&lt;-</span> <span class="fu"><a href="MARSSparamCIs.html">MARSSparamCIs</a></span><span class="op">(</span><span class="va">kemfit</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">kem.with.hess.CIs</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MARSS fit is</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimation method: kem </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimation converged in 20 iterations. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Log-likelihood: 15.70271 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: -19.40541   AICc: -17.57932   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          ML.Est Std.Err   low.CI  up.CI</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A.SJI   0.79691 0.04984  0.69922 0.8946</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A.EBays 0.27579 0.05070  0.17642 0.3752</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> R.diag  0.02236 0.00512  0.01233 0.0324</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U.U     0.06075 0.02145  0.01871 0.1028</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.Q     0.00909 0.00569 -0.00206 0.0202</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.x0   6.10491 0.13330  5.84365 6.3662</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Initial states (x0) defined at t=0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CIs calculated at alpha = 0.05 via method=hessian </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fit a model with 3 hidden states (default)</span></span></span>
<span class="r-in"><span><span class="va">kemfit</span> <span class="op">&lt;-</span> <span class="fu">MARSS</span><span class="op">(</span><span class="va">dat</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># suppress printing</span></span></span>
<span class="r-in"><span><span class="va">kemfit</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MARSS fit is</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimation method: kem </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimation converged in 44 iterations. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Log-likelihood: 17.84491 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: -15.68982   AICc: -10.45173   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     Estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> R.diag               0.00582</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U.X.SJF              0.06833</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U.X.SJI              0.07084</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U.X.EBays            0.04221</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.(X.SJF,X.SJF)      0.04150</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.(X.SJI,X.SJI)      0.01271</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.(X.EBays,X.EBays)  0.00807</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.X.SJF             5.97602</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.X.SJI             6.70656</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.X.EBays           6.63306</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Initial states (x0) defined at t=0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Standard errors have not been calculated. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Use MARSSparamCIs to compute CIs and bias estimates.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fit the above model with BFGS using a short EM fit as initial conditions</span></span></span>
<span class="r-in"><span><span class="va">kemfit</span> <span class="op">&lt;-</span> <span class="fu">MARSS</span><span class="op">(</span><span class="va">dat</span>, control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>minit<span class="op">=</span><span class="fl">5</span>, maxit<span class="op">=</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Warning! Reached maxit before parameters converged. Maxit was 5.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  abstol not reached and no log-log test info since maxit less than min.iter.conv.test.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MARSS fit is</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimation method: kem </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> WARNING: Abstol convergence only no info on log-log convergnece.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  No log-log convergence info because maxit (=5) &lt; min.iter.conv.test (=15).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  The likelihood and params might not be at the ML values.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Try setting control$maxit higher.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Log-likelihood: 15.95084 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     Estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> R.diag                0.0136</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U.X.SJF               0.0683</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U.X.SJI               0.0716</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U.X.EBays             0.0419</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.(X.SJF,X.SJF)       0.0221</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.(X.SJI,X.SJI)       0.0145</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.(X.EBays,X.EBays)   0.0121</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.X.SJF              6.0171</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.X.SJI              6.7335</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.X.EBays            6.6519</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Initial states (x0) defined at t=0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Standard errors have not been calculated. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Use MARSSparamCIs to compute CIs and bias estimates.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Convergence warnings</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  No convergence testing performed.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="va">bffit</span> <span class="op">&lt;-</span> <span class="fu">MARSS</span><span class="op">(</span><span class="va">dat</span>, method<span class="op">=</span><span class="st">"BFGS"</span>, inits<span class="op">=</span><span class="va">kemfit</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Success! Converged in 17 iterations.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Function MARSSkfas used for likelihood calculation.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MARSS fit is</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimation method: BFGS </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimation converged in 17 iterations. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Log-likelihood: 17.852 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: -15.704   AICc: -10.4659   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     Estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> R.diag               0.00539</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U.X.SJF              0.06832</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U.X.SJI              0.07069</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U.X.EBays            0.04229</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.(X.SJF,X.SJF)      0.04309</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.(X.SJI,X.SJI)      0.01312</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.(X.EBays,X.EBays)  0.00833</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.X.SJF             5.97474</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.X.SJI             6.70366</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.X.EBays           6.62806</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Initial states (x0) defined at t=0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Standard errors have not been calculated. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Use MARSSparamCIs to compute CIs and bias estimates.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fit a model with 3 correlated hidden states</span></span></span>
<span class="r-in"><span><span class="co"># with one variance and one  covariance</span></span></span>
<span class="r-in"><span><span class="co"># maxit set low to speed up example, but more iters are needed for convergence</span></span></span>
<span class="r-in"><span><span class="va">kemfit</span> <span class="op">&lt;-</span> <span class="fu">MARSS</span><span class="op">(</span><span class="va">dat</span>, model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Q <span class="op">=</span> <span class="st">"equalvarcov"</span><span class="op">)</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Warning! Reached maxit before parameters converged. Maxit was 50.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  neither abstol nor log-log convergence tests were passed.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MARSS fit is</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimation method: kem </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> WARNING: maxit reached at  50  iter before convergence.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Neither abstol nor log-log convergence test were passed.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  The likelihood and params are not at the MLE values.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Try setting control$maxit higher.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Log-likelihood: 28.72123 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: -39.44246   AICc: -35.25641   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> R.diag       0.0109</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U.X.SJF      0.0669</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U.X.SJI      0.0759</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U.X.EBays    0.0386</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.diag       0.0114</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.offdiag    0.0113</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.X.SJF     5.9930</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.X.SJI     6.6645</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.X.EBays   6.6372</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Initial states (x0) defined at t=0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Standard errors have not been calculated. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Use MARSSparamCIs to compute CIs and bias estimates.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Convergence warnings</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Warning: the  logLik  parameter value has not converged.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Type MARSSinfo("convergence") for more info on this warning.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co"># use Q="unconstrained" to allow different variances and covariances</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fit a model with 3 independent hidden states</span></span></span>
<span class="r-in"><span><span class="co"># where each observation time series is independent</span></span></span>
<span class="r-in"><span><span class="co"># the hidden trajectories 2-3 share their U parameter</span></span></span>
<span class="r-in"><span><span class="va">kemfit</span> <span class="op">&lt;-</span> <span class="fu">MARSS</span><span class="op">(</span><span class="va">dat</span>, model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>U <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"N"</span>, <span class="st">"S"</span>, <span class="st">"S"</span><span class="op">)</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Success! abstol and log-log tests passed at 45 iterations.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Alert: conv.test.slope.tol is 0.5.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Test with smaller values (&lt;0.1) to ensure convergence.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MARSS fit is</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimation method: kem </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimation converged in 45 iterations. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Log-likelihood: 17.48233 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: -16.96465   AICc: -12.77861   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     Estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> R.diag               0.00542</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U.N                  0.06832</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U.S                  0.05330</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.(X.SJF,X.SJF)      0.04279</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.(X.SJI,X.SJI)      0.01382</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.(X.EBays,X.EBays)  0.00862</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.X.SJF             5.97495</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.X.SJI             6.72656</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.X.EBays           6.61015</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Initial states (x0) defined at t=0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Standard errors have not been calculated. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Use MARSSparamCIs to compute CIs and bias estimates.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># same model, but with fixed independent observation errors</span></span></span>
<span class="r-in"><span><span class="co"># and the 3rd x processes are forced to have a U=0</span></span></span>
<span class="r-in"><span><span class="co"># Notice how a list matrix is used to combine fixed and estimated elements</span></span></span>
<span class="r-in"><span><span class="co"># all parameters can be specified in this way using list matrices</span></span></span>
<span class="r-in"><span><span class="va">kemfit</span> <span class="op">&lt;-</span> <span class="fu">MARSS</span><span class="op">(</span><span class="va">dat</span>, model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>U <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"N"</span>, <span class="st">"N"</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span>, R <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Success! algorithm run for 15 iterations. abstol and log-log tests passed.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Alert: conv.test.slope.tol is 0.5.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Test with smaller values (&lt;0.1) to ensure convergence.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MARSS fit is</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimation method: kem </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Algorithm ran 15 (=minit) iterations and convergence was reached. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Log-likelihood: 15.47987 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: -16.95974   AICc: -14.47085   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     Estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U.N                   0.0709</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.(X.SJF,X.SJF)       0.0296</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.(X.SJI,X.SJI)       0.0107</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.(X.EBays,X.EBays)   0.0116</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.X.SJF              5.9871</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.X.SJI              6.7310</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.X.EBays            6.7139</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Initial states (x0) defined at t=0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Standard errors have not been calculated. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Use MARSSparamCIs to compute CIs and bias estimates.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fit a model with 2 hidden states (north and south)</span></span></span>
<span class="r-in"><span><span class="co"># where observation time series 1-2 are north and 3 is south</span></span></span>
<span class="r-in"><span><span class="co"># Make the hidden state process independent with same process var</span></span></span>
<span class="r-in"><span><span class="co"># Make the observation errors different but independent</span></span></span>
<span class="r-in"><span><span class="co"># Make the growth parameters (U) the same</span></span></span>
<span class="r-in"><span><span class="co"># Create a Z matrix as a design matrix that assigns the "N" state to the first 2 rows of dat</span></span></span>
<span class="r-in"><span><span class="co"># and the "S" state to the 3rd row of data</span></span></span>
<span class="r-in"><span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># You can use factor is a shortcut making the above design matrix for Z</span></span></span>
<span class="r-in"><span><span class="co"># Z &lt;- factor(c("N","N","S"))</span></span></span>
<span class="r-in"><span><span class="co"># name the state vectors</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"N"</span>, <span class="st">"S"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">kemfit</span> <span class="op">&lt;-</span> <span class="fu">MARSS</span><span class="op">(</span><span class="va">dat</span>, model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  Z <span class="op">=</span> <span class="va">Z</span>,</span></span>
<span class="r-in"><span>  Q <span class="op">=</span> <span class="st">"diagonal and equal"</span>, R <span class="op">=</span> <span class="st">"diagonal and unequal"</span>, U <span class="op">=</span> <span class="st">"equal"</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Success! abstol and log-log tests passed at 32 iterations.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Alert: conv.test.slope.tol is 0.5.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Test with smaller values (&lt;0.1) to ensure convergence.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MARSS fit is</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimation method: kem </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimation converged in 32 iterations. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Log-likelihood: 24.7002 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: -33.4004   AICc: -30.12767   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 Estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A.SJI            0.79810</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> R.(SJF,SJF)      0.02473</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> R.(SJI,SJI)      0.00581</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> R.(EBays,EBays)  0.00305</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U.1              0.05641</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.diag           0.01160</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.N             5.94175</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.S             6.58600</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Initial states (x0) defined at t=0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Standard errors have not been calculated. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Use MARSSparamCIs to compute CIs and bias estimates.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># print the model followed by the marssMLE object</span></span></span>
<span class="r-in"><span><span class="va">kemfit</span><span class="op">$</span><span class="va">model</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model form is marxss. Model Structure is</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> m: 2 state process(es) named N S</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> n: 3 observation time series named SJF SJI EBays</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Z :  design matrix with rows: N S N S (3 x 2) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A :  see summary() (3 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> R :  diagonal and unequal (3 x 3) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> B :  identity (2 x 2) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U :  all equal (2 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q :  diagonal and equal (2 x 2) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0 :  unconstrained (2 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> V0 :  fixed and zero (2 x 2) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> D :  fixed and zero (3 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> C :  fixed and zero (2 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> d :  fixed and zero (1 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c :  fixed and zero (1 x 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> G :  identity (2 x 2) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> H :  identity (3 x 3) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> L :  identity (2 x 2) </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># simulate some new data from our fitted model</span></span></span>
<span class="r-in"><span><span class="va">sim.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="MARSSsimulate.html">MARSSsimulate</a></span><span class="op">(</span><span class="va">kemfit</span>, nsim <span class="op">=</span> <span class="fl">10</span>, tSteps <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compute bootstrap AIC for the model; this takes a long, long time</span></span></span>
<span class="r-in"><span><span class="va">kemfit.with.AICb</span> <span class="op">&lt;-</span> <span class="fu"><a href="MARSSaic.html">MARSSaic</a></span><span class="op">(</span><span class="va">kemfit</span>, output <span class="op">=</span> <span class="st">"AICbp"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">kemfit.with.AICb</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># Many more short examples can be found in the</span></span></span>
<span class="r-in"><span><span class="co"># Quick Examples chapter in the User Guide</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/RShowDoc.html" class="external-link">RShowDoc</a></span><span class="op">(</span><span class="st">"UserGuide"</span>, package <span class="op">=</span> <span class="st">"MARSS"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># You can find the R scripts from the chapters by</span></span></span>
<span class="r-in"><span><span class="co"># going to the index page</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/RShowDoc.html" class="external-link">RShowDoc</a></span><span class="op">(</span><span class="st">"index"</span>, package <span class="op">=</span> <span class="st">"MARSS"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Elizabeth Eli Holmes, Eric J. Ward, Mark D. Scheuerell, Kellie Wills.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

