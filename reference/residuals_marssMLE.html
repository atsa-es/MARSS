<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='residuals.marssMLE returns a data frame with fitted values, residuals, residual standard deviation (sigma), and standardized residuals. A residual is the difference between the "value" of the model (\(\mathbf{y}\)) or  state (\(\mathbf{x}\)) and the fitted value.  At time \(t\) (in the returned data frame), the model residuals are for time \(t\). For the the state residuals, the residual is for the transition from \(t\) to \(t+1\) following the convention in Harvey, Koopman and Penzer (1998). For the the state innovation residuals, this means that state.residual[,t] is for the transition from \(t\) to \(t+1\) and is conditioned on data 1 to \(t\) while model.residual[,t] is is conditioned on data 1 to \(t-1\). State innovation residuals are not normally used while state smoothation residuals are used in trend outlier analysis. If warnings are reported, use attr(residuals(fit), "msg") to retrieve the messages.
Because the state residuals is for the transition from \(t\) to \(t+1\), this means that the state residual .resids[t] is value[t-1] minus .fitted[t-1] in the outputted data frame.'><title>Model and state fitted values, residuals, and residual sigma — residuals.marssMLE • MARSS</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><script src="../extra.js"></script><meta property="og:title" content="Model and state fitted values, residuals, and residual sigma — residuals.marssMLE"><meta property="og:description" content='residuals.marssMLE returns a data frame with fitted values, residuals, residual standard deviation (sigma), and standardized residuals. A residual is the difference between the "value" of the model (\(\mathbf{y}\)) or  state (\(\mathbf{x}\)) and the fitted value.  At time \(t\) (in the returned data frame), the model residuals are for time \(t\). For the the state residuals, the residual is for the transition from \(t\) to \(t+1\) following the convention in Harvey, Koopman and Penzer (1998). For the the state innovation residuals, this means that state.residual[,t] is for the transition from \(t\) to \(t+1\) and is conditioned on data 1 to \(t\) while model.residual[,t] is is conditioned on data 1 to \(t-1\). State innovation residuals are not normally used while state smoothation residuals are used in trend outlier analysis. If warnings are reported, use attr(residuals(fit), "msg") to retrieve the messages.
Because the state residuals is for the transition from \(t\) to \(t+1\), this means that the state residual .resids[t] is value[t-1] minus .fitted[t-1] in the outputted data frame.'><meta property="og:image" content="https://atsa-es.github.io/MARSS/logo.png"><!-- mathjax --><script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js">
</script><!--
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
--><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MARSS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.11.8</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/atsa-es/MARSS/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Model and state fitted values, residuals, and residual sigma</h1>
      
      <div class="d-none name"><code>residuals_marssMLE.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>residuals.marssMLE</code> returns a data frame with fitted values, residuals, residual standard deviation (sigma), and standardized residuals. A residual is the difference between the "value" of the model (\(\mathbf{y}\)) or  state (\(\mathbf{x}\)) and the fitted value.  At time \(t\) (in the returned data frame), the model residuals are for time \(t\). For the the state residuals, the residual is for the transition from \(t\) to \(t+1\) following the convention in Harvey, Koopman and Penzer (1998). For the the state innovation residuals, this means that <code>state.residual[,t]</code> is for the transition from \(t\) to \(t+1\) and is conditioned on data 1 to \(t\) while <code>model.residual[,t]</code> is is conditioned on data 1 to \(t-1\). State innovation residuals are not normally used while state smoothation residuals are used in trend outlier analysis. If warnings are reported, use <code>attr(residuals(fit), "msg")</code> to retrieve the messages.</p>
<p>Because the state residuals is for the transition from \(t\) to \(t+1\), this means that the state residual <code>.resids[t]</code> is <code>value[t-1]</code> minus <code>.fitted[t-1]</code> in the outputted data frame.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for marssMLE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span>, </span>
<span>           type<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tt1"</span>, <span class="st">"tT"</span>, <span class="st">"tt"</span><span class="op">)</span>,</span>
<span>           standardization<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cholesky"</span>, <span class="st">"marginal"</span>, <span class="st">"Block.Cholesky"</span><span class="op">)</span>,</span>
<span>           form<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">object</span><span class="op">[[</span><span class="st">"model"</span><span class="op">]</span><span class="op">]</span>, <span class="st">"form"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>           clean<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>object</dt>
<dd><p>a <code><a href="marssMLE-class.html">marssMLE</a></code> object</p></dd>

  
  <dt>type</dt>
<dd><p><code>tt1</code> means innovations residuals. The fitted values are computed conditioned on the data up to \(t-1\). See <code><a href="fitted_marssMLE.html">fitted</a>()</code> with <code>type="ytt1"</code> or <code>type="xtt1"</code>. <code>tT</code> means smoothation residuals. the fitted values are computed conditioned on all the data. See <code><a href="fitted_marssMLE.html">fitted</a>()</code> with <code>type="ytT"</code> or <code>type="xtT"</code>. <code>tt</code> means contemporaneous residuals. The fitted values are computed conditioned on the data up to \(t\). In MARSS functions, estimates at time \(t\) conditioned on data 1 to \(T\) are denoted <code>tT</code>, conditioned on the data from \(t=1\) to \(t-1\) are denoted <code>tt1</code> and conditioned on data 1 to \(t\) are <code>tt</code>.</p></dd>


  <dt>standardization</dt>
<dd><p>"Cholesky" means it is standardized by the lower triangle of the Cholesky transformation of the full variance-covariance matrix of the model and state residuals. 
"marginal" means that the residual is standardized by its standard deviation, i.e. the square root of the value on the diagonal of the variance-covariance matrix of the model and state residuals. 
"Block.Cholesky" means the model or state residuals are standardized by the lower triangle of the Cholesky transformation of only their variance-covariance matrix (not the joint model and state variance-covariance matrix).</p></dd>

 
  <dt>form</dt>
<dd><p>For developers. Can be ignored. If you want the function to use a different function than <code>residuals_form</code>.  This might be useful if you manually specified a DFA model and want to use <code>residuals_dfa</code> for rotating.</p></dd>


  <dt>clean</dt>
<dd><p>Can be ignored. For <code>type="tt1"</code>, state residuals are not used for residuals analysis and for <code>type="tt"</code>, they don't exist (all NA). They are used only for smoothation residuals, <code>type="tT"</code>.  For <code>type="tt1"</code> and <code>type="tt"</code>, the data frame is cleaned by removing <code>name=="state"</code> when <code>clean=TRUE</code>.</p></dd>

  
  <dt>...</dt>
<dd><p>Not used.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A data frame with the following columns:</p>
<dl><dt>type</dt>
<dd><p>tT, tt1 or tt</p></dd>

<dt>.rownames</dt>
<dd><p>The names of the observation rows or the state rows.</p></dd>

<dt>name</dt>
<dd><p>model or state</p></dd>

<dt>t</dt>
<dd><p>time step</p></dd>

<dt>value</dt>
<dd><p>The data value if <code>name</code> equals "model" or the \(x\) estimate if <code>name</code> equals "state" at time \(t\). See details.</p></dd>

<dt>.fitted</dt>
<dd><p>Model predicted values of observations or states at time \(t\). See details.</p></dd>

<dt>.resids</dt>
<dd><p>Model or states residuals. See details.</p></dd>

<dt>.sigma</dt>
<dd><p>The standard error of the model or state residuals. Intervals for the residuals can be constructed from <code>.sigma</code> using <code>qnorm(alpha/2)*.sigma + .fitted.</code></p></dd>

<dt>.std.resids</dt>
<dd><p>Standardized residuals. See <code><a href="MARSSresiduals.html">MARSSresiduals</a></code> for a discussion of residual standardization.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    

<p>See <code><a href="MARSSresiduals.html">MARSSresiduals</a></code> for a discussion of the residuals calculations for MARSS models.</p>
<p><strong>value</strong> and <strong>.fitted</strong></p>
<p>See the discussion below on the meaning of these for \(\mathbf{y}\) associated residuals (model residuals) or \(\mathbf{x}\) associated residuals (state residuals).</p>
<p><strong>model residuals</strong></p>
<p>The model residuals are in the data frame with <code>name=="model"</code>.</p>
<p>The model residuals are the familiar type of residuals, they are the difference between the data at time \(t\) and the predicted value at time \(t\), labeled <code>.fitted</code> in the data frame. For the model residuals, the "value"" is the data (or NA if data are missing). If <code>type="tT"</code>, the predicted value is the expected value of \(\mathbf{Y}\) conditioned on all the data, i.e. is computed using the smoothed estimate of \(\mathbf{x}\) at time \(t\) (<code>xtT</code>).  If <code>type="tt1"</code>, the predicted value is the expected value of \(\mathbf{Y}\) conditioned on the data up to time \(t-1\), i.e. is computed using the estimate of \(\mathbf{x}\) at time \(t\) conditioned on the data up to time \(t-1\) (<code>xtt1</code>). These are known as the one-step-ahead predictions and the residuals are known as the innovations.</p>
<p>The standard errors help visualize how well the model fits to the data.  See <code><a href="fitted_marssMLE.html">fitted</a></code> for a discussion of the calculation of the model predictions for the observations.  The standardized smoothation residuals can be used for outlier detection.  See the references in <code><a href="MARSSresiduals.html">MARSSresiduals</a></code> and the chapter on shock detection in the MARSS User Guide.</p>
<p><strong>state residuals</strong></p>
<p>The state residuals are in the data frame with <code>name=="state"</code>.</p>
<p>If you want the expected value of the states and an estimate of their standard errors (for confidence intervals), then <code><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals()</a></code> is not what you want to use.  You want to use <code><a href="tsSmooth_marssMLE.html">tsSmooth</a>(..., type="xtT")</code> to return the smoothed estimate of the state or you can find the states in the <code>states</code> element of the <code><a href="marssMLE-class.html">marssMLE</a></code> object returned by a <code><a href="MARSS.html">MARSS()</a></code> call. For the one-step-ahead state estimates, use <code><a href="tsSmooth_marssMLE.html">tsSmooth</a>(..., type="xtt1")</code>.</p>
<p>The state residuals are only for state-space models. At time \(t\), the state residuals are the difference between the state estimate at time \(t+1\) and the predicted value of the state at time \(t+1\) given the estimate of the state at time \(t\). For smoothation state residuals, this is 
$$ \hat{\mathbf{w}}_{t+1} = \mathbf{x}_{t+1}^T - \mathbf{B}\mathbf{x}_{t}^T - \mathbf{u} - \mathbf{C}\mathbf{c}_{t+1}$$
For "tt1" state residuals, this is 
$$ \hat{\mathbf{w}}_{t+1} = \mathbf{x}_{t+1}^{t+1} - \mathbf{B}\mathbf{x}_{t}^t - \mathbf{u}  - \mathbf{C}\mathbf{c}_{t+1}$$.
Note the t indexing is offset. The state residual at time t is the estimate at time t+1 minus the fitted value at t+1.</p>
<p>Smoothation state residuals are used for outlier detection or shock detection in the state process.  See <code><a href="MARSSresiduals.html">MARSSresiduals</a></code> and read the references cited. Note that the state residual at time \(T\) (the last time step) is NA since this would be the transition from \(T\) to \(T+1\) (past the end of the data).</p>
<p>Note, because the state residuals are for the transition from \(t\) to \(t+1\), this means that in the outputted data frame, the state residual <code>.resids[t]</code> is <code>value[t-1]</code> minus <code>.fitted[t-1]</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Holmes, E. E. 2014. Computation of standardized residuals for (MARSS) models. Technical Report. arXiv:1411.0045.</p>
<p>See also the discussion and references in <code><a href="MARSSresiduals_tT.html">MARSSresiduals.tT</a></code>, <code><a href="MARSSresiduals_tt1.html">MARSSresiduals.tt1</a></code> and <code><a href="MARSSresiduals_ttt.html">MARSSresiduals.tt</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">harborSeal</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">11</span>, <span class="fl">12</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="MARSS.html">MARSS</a></span><span class="op">(</span><span class="va">dat</span>, model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WA"</span>, <span class="st">"OR"</span>, <span class="st">"OR"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Success! abstol and log-log tests passed at 37 iterations.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Alert: conv.test.slope.tol is 0.5.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Test with smaller values (&lt;0.1) to ensure convergence.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MARSS fit is</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimation method: kem </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimation converged in 37 iterations. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Log-likelihood: 13.72233 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: -11.44465   AICc: -8.918339   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 Estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A.OR.SouthCoast  0.49280</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> R.diag           0.02509</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U.WA             0.06171</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U.OR             0.03686</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.(WA,WA)        0.01082</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.(OR,OR)        0.00439</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.WA            7.41712</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.OR            6.56460</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Initial states (x0) defined at t=0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Standard errors have not been calculated. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Use MARSSparamCIs to compute CIs and bias estimates.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># Show a series of standard residuals diagnostic plots for state-space models</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">fit</span>, plot.type<span class="op">=</span><span class="st">"residuals"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">fit</span>, type<span class="op">=</span><span class="st">"tt1"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># Make a series of diagnostic plots from a residuals object</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Manually make a plot of the model residuals (innovations) with intervals</span></span></span>
<span class="r-in"><span><span class="va">d</span><span class="op">$</span><span class="va">.conf.low</span> <span class="op">&lt;-</span> <span class="va">d</span><span class="op">$</span><span class="va">.fitted</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">0.05</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="va">d</span><span class="op">$</span><span class="va">.sigma</span></span></span>
<span class="r-in"><span><span class="va">d</span><span class="op">$</span><span class="va">.conf.up</span> <span class="op">&lt;-</span> <span class="va">d</span><span class="op">$</span><span class="va">.fitted</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">0.05</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="va">d</span><span class="op">$</span><span class="va">.sigma</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">d</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">.fitted</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">value</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, ymin <span class="op">=</span> <span class="va">.conf.low</span>, ymax <span class="op">=</span> <span class="va">.conf.up</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Model residuals (innovations)"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time Step"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">.rownames</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="residuals_marssMLE-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># NOTE state residuals are for t to t+1 while the value and fitted columns </span></span></span>
<span class="r-in"><span><span class="co"># are for t. So (value-fitted)[t] matches .resids[t+1] NOT .resids[t]</span></span></span>
<span class="r-in"><span><span class="co"># This is only for state residuals. For model residuals, the time-indexing matches.</span></span></span>
<span class="r-in"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">fit</span>, type<span class="op">=</span><span class="st">"tT"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dsub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">name</span><span class="op">==</span><span class="st">"state"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># note t in col 1 matches t+1 in col 2</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>.resids<span class="op">=</span><span class="va">dsub</span><span class="op">$</span><span class="va">.resids</span>, valminusfitted<span class="op">=</span><span class="va">dsub</span><span class="op">$</span><span class="va">value</span><span class="op">-</span><span class="va">dsub</span><span class="op">$</span><span class="va">.fitted</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         .resids valminusfitted</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.01903551   4.627561e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 0.06079751   1.903551e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 0.07850122   6.079751e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,] 0.06585972   7.850122e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,] 0.06585972   6.585972e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6,] 0.11653915   6.585972e-02</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Make a plot of the smoothation residuals</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">d</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">value</span><span class="op">-</span><span class="va">.fitted</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">.rownames</span><span class="op">+</span><span class="va">name</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Smoothation residuals (state and model)"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time Step"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Count"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="residuals_marssMLE-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Make a plot of xtT versus prediction of xt from xtT[t-1]</span></span></span>
<span class="r-in"><span><span class="co"># This is NOT the estimate of the smoothed states with CIs. Use tsSmooth() for that.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">name</span><span class="op">==</span><span class="st">"state"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">value</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, <span class="va">.fitted</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">.rownames</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time Step"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"xtT (points) and prediction (line)"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="residuals_marssMLE-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Make a plot of y versus prediction of yt from xtT[t]</span></span></span>
<span class="r-in"><span><span class="co"># Why doesn't the OR line go through the points?</span></span></span>
<span class="r-in"><span><span class="co"># Because there is only one OR state line and it needs to go through</span></span></span>
<span class="r-in"><span><span class="co"># both sets of OR data.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">name</span><span class="op">==</span><span class="st">"model"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">value</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, <span class="va">.fitted</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">.rownames</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time Step"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"data (points) and prediction (line)"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="residuals_marssMLE-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Elizabeth Eli Holmes, Eric J. Ward, Mark D. Scheuerell, Kellie Wills.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

