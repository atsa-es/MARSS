<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='


tsSmooth.marssMLE returns the estimated state and observations conditioned on the data. This function will return either the smoothed values (conditioned on all the data) or the filtered values (conditioned on data 1 to \(t\) or \(t-1\)). This is output from the Kalman filter and smoother MARSSkf() for the \(\mathbf{x}\) and from the corresponding function MARSShatyt() for the \(\mathbf{y}\).
These are the expected value of the full right side of the MARSS equations with the error terms (expected value of \(\mathbf{X}_t\) and \(\mathbf{Y}_t\)). Conditioning on data \(t=1\) to \(t-1\) (one-step ahead), \(t\) (contemporaneous), or \(T\) (smoothed) is provided. This is in contrast to fitted() which returns the expected value of the right side without the error term, aka model predictions.
In the state-space literature, the \(\mathbf{y}\) "estimates" would normally refer to the expected value of the right-side of the \(\mathbf{y}\) equation without the error term (i.e. the expected value of \(\mathbf{Z} \mathbf{X}_t + \mathbf{a} + \mathbf{D}\mathbf{d}_t\)). That is provided in fitted(). tsSmooth.marssMLE() provides the expected value with the error terms conditioned on the data from 1 to \(t-1\), \(t\), or \(T\). These estimates are used to estimate missing values in the data. If \(\mathbf{y}\) is multivariate, some \(y\) are missing at time \(t\) and some not, and \(\mathbf{R}\) is non-diagonal, then the expected value of \(\mathbf{Y}_t\) from the right-side of the \(\mathbf{y}\) without the error terms would be incorrect because it would not take into account the information in the observed data at time \(t\) on the missing data at time \(t\) (except as it influences \(\mathrm{E}[\mathbf{x}_t]\)).
Note, if there are no missing values, the expected value of \(\mathbf{Y}_t\) (with error terms) conditioned on the data from 1 to \(t\) or \(T\) is simply \(\mathbf{y}_t\). The expectation is only useful when there are missing values for which an estimate is needed. The expectation of the \(\mathbf{Y}\) with the error terms is used in the EM algorithm for the general missing values case and the base function is MARSShatyt().'><title>Smoothed and filtered x and y time series — tsSmooth.marssMLE • MARSS</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><script src="../extra.js"></script><meta property="og:title" content="Smoothed and filtered x and y time series — tsSmooth.marssMLE"><meta property="og:description" content='


tsSmooth.marssMLE returns the estimated state and observations conditioned on the data. This function will return either the smoothed values (conditioned on all the data) or the filtered values (conditioned on data 1 to \(t\) or \(t-1\)). This is output from the Kalman filter and smoother MARSSkf() for the \(\mathbf{x}\) and from the corresponding function MARSShatyt() for the \(\mathbf{y}\).
These are the expected value of the full right side of the MARSS equations with the error terms (expected value of \(\mathbf{X}_t\) and \(\mathbf{Y}_t\)). Conditioning on data \(t=1\) to \(t-1\) (one-step ahead), \(t\) (contemporaneous), or \(T\) (smoothed) is provided. This is in contrast to fitted() which returns the expected value of the right side without the error term, aka model predictions.
In the state-space literature, the \(\mathbf{y}\) "estimates" would normally refer to the expected value of the right-side of the \(\mathbf{y}\) equation without the error term (i.e. the expected value of \(\mathbf{Z} \mathbf{X}_t + \mathbf{a} + \mathbf{D}\mathbf{d}_t\)). That is provided in fitted(). tsSmooth.marssMLE() provides the expected value with the error terms conditioned on the data from 1 to \(t-1\), \(t\), or \(T\). These estimates are used to estimate missing values in the data. If \(\mathbf{y}\) is multivariate, some \(y\) are missing at time \(t\) and some not, and \(\mathbf{R}\) is non-diagonal, then the expected value of \(\mathbf{Y}_t\) from the right-side of the \(\mathbf{y}\) without the error terms would be incorrect because it would not take into account the information in the observed data at time \(t\) on the missing data at time \(t\) (except as it influences \(\mathrm{E}[\mathbf{x}_t]\)).
Note, if there are no missing values, the expected value of \(\mathbf{Y}_t\) (with error terms) conditioned on the data from 1 to \(t\) or \(T\) is simply \(\mathbf{y}_t\). The expectation is only useful when there are missing values for which an estimate is needed. The expectation of the \(\mathbf{Y}\) with the error terms is used in the EM algorithm for the general missing values case and the base function is MARSShatyt().'><meta property="og:image" content="https://atsa-es.github.io/MARSS/logo.png"><!-- mathjax --><script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js">
</script><!--
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
--><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MARSS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.11.9</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/atsa-es/MARSS/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Smoothed and filtered x and y time series</h1>
      
      <div class="d-none name"><code>tsSmooth_marssMLE.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    


<p><code>tsSmooth.marssMLE</code> returns the estimated state and observations conditioned on the data. This function will return either the smoothed values (conditioned on all the data) or the filtered values (conditioned on data 1 to \(t\) or \(t-1\)). This is output from the Kalman filter and smoother <code><a href="MARSSkf.html">MARSSkf</a>()</code> for the \(\mathbf{x}\) and from the corresponding function <code><a href="MARSShatyt.html">MARSShatyt</a>()</code> for the \(\mathbf{y}\).</p>
<p>These are the expected value of the full right side of the MARSS equations with the error terms (expected value of \(\mathbf{X}_t\) and \(\mathbf{Y}_t\)). Conditioning on data \(t=1\) to \(t-1\) (one-step ahead), \(t\) (contemporaneous), or \(T\) (smoothed) is provided. This is in contrast to <code><a href="fitted_marssMLE.html">fitted</a>()</code> which returns the expected value of the right side without the error term, aka model predictions.</p>
<p>In the state-space literature, the \(\mathbf{y}\) "estimates" would normally refer to the expected value of the right-side of the \(\mathbf{y}\) equation without the error term (i.e. the expected value of \(\mathbf{Z} \mathbf{X}_t + \mathbf{a} + \mathbf{D}\mathbf{d}_t\)). That is provided in <code><a href="fitted_marssMLE.html">fitted</a>()</code>. <code>tsSmooth.marssMLE()</code> provides the expected value with the error terms conditioned on the data from 1 to \(t-1\), \(t\), or \(T\). These estimates are used to estimate missing values in the data. If \(\mathbf{y}\) is multivariate, some \(y\) are missing at time \(t\) and some not, and \(\mathbf{R}\) is non-diagonal, then the expected value of \(\mathbf{Y}_t\) from the right-side of the \(\mathbf{y}\) without the error terms would be incorrect because it would not take into account the information in the observed data at time \(t\) on the missing data at time \(t\) (except as it influences \(\mathrm{E}[\mathbf{x}_t]\)).</p>
<p>Note, if there are no missing values, the expected value of \(\mathbf{Y}_t\) (with error terms) conditioned on the data from 1 to \(t\) or \(T\) is simply \(\mathbf{y}_t\). The expectation is only useful when there are missing values for which an estimate is needed. The expectation of the \(\mathbf{Y}\) with the error terms is used in the EM algorithm for the general missing values case and the base function is <code><a href="MARSShatyt.html">MARSShatyt</a>()</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for marssMLE</span></span>
<span><span class="fu">tsSmooth</span><span class="op">(</span><span class="va">object</span>, </span>
<span>    type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"xtT"</span>, <span class="st">"xtt"</span>, <span class="st">"xtt1"</span>, <span class="st">"ytT"</span>, <span class="st">"ytt"</span>, <span class="st">"ytt1"</span><span class="op">)</span>,</span>
<span>    interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"confidence"</span>, <span class="st">"prediction"</span><span class="op">)</span>,</span>
<span>    level <span class="op">=</span> <span class="fl">0.95</span>, fun.kf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MARSSkfas"</span>, <span class="st">"MARSSkfss"</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>object</dt>
<dd><p>A <code><a href="marssMLE-class.html">marssMLE</a></code> object.</p></dd>

  
  <dt>type</dt>
<dd><p>Type of estimates to return. Smoothed states (<code>xtT</code>), one-step-ahead states (<code>xtt1</code>), contemporaneous states (<code>xtt</code>), the model <code>ytT</code> (<code>Z xtT + A + D d(t)</code>), the model <code>ytt</code> (<code>Z xtt + A + D d(t)</code>), the model <code>ytt1</code> (<code>Z xtt1 + A + D d(t)</code>), the expected value of \(\mathbf{Y}_t\) conditioned on data 1 to \(t-1\) (<code>ytt1</code>), the expected value of \(\mathbf{Y}_t\) conditioned on data 1 to \(t\) (<code>ytt</code>), or the expected value of \(\mathbf{Y}_t\) conditioned on data 1 to \(T\) (<code>ytT</code>). See details.</p></dd>

  
<dt>interval</dt>
<dd><p>If <code>interval="confidence"</code>, then the standard error and confidence intervals are returned. There are no prediction intervals for estimated states and observations except for <code>ytT</code> (which is a unusual case.) If you are looking for prediction intervals, then you want <code><a href="fitted_marssMLE.html">fitted</a>()</code> or <code><a href="predict_marssMLE.html">predict</a>()</code>.</p></dd>


  <dt>level</dt>
<dd><p>Confidence level. alpha=1-level</p></dd>

 
  <dt>fun.kf</dt>
<dd><p>By default, <code>tsSmooth()</code> will use the Kalman filter/smoother function in <code>object$fun.kf</code> (either <code><a href="MARSSkf.html">MARSSkfas</a>()</code> or <code><a href="MARSSkf.html">MARSSkfss</a>()</code>). You can pass in <code>fun.kf</code> to force a particular Kalman filter/smoother function to be used.</p></dd>

  
  <dt>...</dt>
<dd><p>Optional arguments.  If form="dfa", <code>rotate=TRUE</code> can be passed in to rotate the trends (only trends not the \(\mathbf{Z}\) matrix).</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A data frame with the following columns is returned. Values computed from the model are prefaced with ".".</p>


<p>If <code>interval="none"</code>, the following are returned:</p>
<dl><dt>.rownames</dt>
<dd><p>Names of the data or states.</p></dd>

<dt>t</dt>
<dd><p>Time step.</p></dd>

<dt>y</dt>
<dd><p>The data if <code>type</code> is <code>"ytT"</code>, <code>"ytt"</code> or <code>"ytt1"</code>.</p></dd>

<dt>.estimate</dt>
<dd><p>The estimated values. See details.</p></dd>


</dl><p>If <code>interval = "confidence"</code>, the following are also returned:</p>
<dl><dt>.se</dt>
<dd><p>Standard errors of the estimates.</p></dd>

<dt>.conf.low</dt>
<dd><p>Lower confidence level at <code>alpha = 1-level</code>. The interval is approximated using qnorm(alpha/2)*se + estimate</p></dd>

<dt>.conf.up</dt>
<dd><p>Upper confidence level. The interval is approximated using qnorm(1-alpha/2)*se + estimate</p></dd>


</dl><p>If <code>interval = "prediction"</code>, the following are also returned:</p>
<dl><dt>.sd</dt>
<dd><p>Standard deviation of new \(\mathbf{y}_t\) values.</p></dd>

<dt>.lwr</dt>
<dd><p>Lower range at <code>alpha = 1-level</code>. The interval is approximated using qnorm(alpha/2)*sd + estimate</p></dd>

<dt>.upr</dt>
<dd><p>Upper range at <code>level</code>. The interval is approximated using qnorm(1-alpha/2)*sd + estimate</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    

<p>Below, X and Y refers to the random variable and x and y refer to a specific realization from this random variable.</p>  
<p><strong>state estimates (x)</strong></p>
<p>For <code>type="xtT"</code>, <code>tsSmooth.marssMLE</code> returns the confidence intervals of the state at time \(t\) conditioned on the data from 1 to \(T\) using the estimated model parameters as true values. These are the standard intervals that are shown for the estimated states in state-space models. For example see, Shumway and Stoffer (2000), edition 4, Figure 6.4. As such, this is probably what you are looking for if you want to put intervals on the estimated states (the \(\mathbf{x}\)). However, these intervals do not include parameter uncertainty. If you want state residuals (for residuals analysis), use <code><a href="MARSSresiduals.html">MARSSresiduals</a>()</code> or <code><a href="residuals_marssMLE.html">residuals</a>()</code>.</p>
<p><strong>Quantiles</strong> The state \(\mathbf{X}_t\) in a MARSS model has a conditional multivariate normal distribution, that can be computed from the model parameters and data. In Holmes (2012, Equation 11) notation, its expected value conditioned on all the observed data and the model parameters \(\Theta\) is denoted \(\tilde{\mathbf{x}}_t\) or equivalently \(\mathbf{x}_t^T\) (where the $T$ superscript is not a power but the upper extent of the time conditioning). In <code><a href="MARSSkf.html">MARSSkf</a></code>, this is <code>xtT[,t]</code>. The variance of \(\mathbf{X}_t\) conditioned on all the observed data and \(\Theta\) is \(\tilde{\mathbf{V}}_t\) (<code>VtT[,,t]</code>). Note that <code>VtT[,,t] != B VtT[,,t-1] t(B) + Q</code>, which you might think by looking at the MARSS equations. That is because the variance of \(\mathbf{W}_t\) conditioned on the data (past, current and FUTURE) is not equal to  \(\mathbf{Q}\) (\(\mathbf{Q}\) is the unconditional variance).</p>
<p>\(\mathbf{x}_t^T\) (<code>xtT[,t]</code>) is an estimate of \(\mathbf{x}_t\) and the standard error of that estimate is given by \(\mathbf{V}_t^T\) (<code>VtT[,,t]</code>). Let <code>se.xt</code> denote the sqrt of the diagonal of <code>VtT</code>. The equation for the \(\alpha/2\) confidence interval is (<code>qnorm(alpha/2)*se.xt + xtT</code>). \(\mathbf{x}_t\) is multivariate and this interval is for one of the \(x\)'s in isolation. You could compute the m-dimensional confidence region for the multivariate \(\mathbf{x}_t\), also, but <code>tsSmooth.marssMLE</code> returns the univariate confidence intervals.</p>
<p>The variance <code>VtT</code> gives information on the uncertainty of the true location of \(\mathbf{x}_t\) conditioned on the observed data. As more data are collected (or added to the analysis), this variance will shrink since the data, especially data at time \(t\), increases the information about the locations of \(\mathbf{x}_t\). This does not affect the estimation of the model parameters, those are fixed (we are assuming), but rather our information about the states at time \(t\).</p>
<p>If you have a DFA model (form='dfa'), you can pass in <code>rotate=TRUE</code> to return the rotated trends.  If you want the rotated loadings, you will need to compute those yourself:</p><div class="sourceCode"><pre><code><span></span>
<span><span class="va">dfa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MARSS.html">MARSS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">harborSealWA</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, model<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, form<span class="op">=</span><span class="st">"dfa"</span><span class="op">)</span></span>
<span><span class="va">Z.est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">dfa</span>, type<span class="op">=</span><span class="st">"matrix"</span><span class="op">)</span><span class="op">$</span><span class="va">Z</span></span>
<span><span class="va">H.inv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/varimax.html" class="external-link">varimax</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">dfa</span>, type<span class="op">=</span><span class="st">"matrix"</span><span class="op">)</span><span class="op">$</span><span class="va">Z</span><span class="op">)</span><span class="op">$</span><span class="va">rotmat</span></span>
<span><span class="va">Z.rot</span> <span class="op">&lt;-</span> <span class="va">Z.est</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">H.inv</span></span></code></pre></div>

<p>For <code>type="xtt"</code> and <code>type=="xtt1"</code>, the calculations and interpretations of the intervals are the same but the conditioning is for data \(t=1\) to \(t\) or \(t=1\) to \(t-1\).</p>

<p><strong>observation estimates (y)</strong></p>
<p>For <code>type="ytT"</code>, this returns the expected value and standard error of \(\mathbf{Y}_t\) (left-hand side of the \(\mathbf{y}\) equation) conditioned on \(\mathbf{Y}_t=y_t\). If you have no missing data, this just returns your data set. But you have missing data, this what you want in order to estimate the values of missing data in your data set. The expected value of \(\mathbf{Y}_t|\mathbf{Y}=\mathbf{y}(1:T)\) is in <code>ytT</code> in <code><a href="MARSShatyt.html">MARSShatyt</a>()</code> output and the variance is <code>OtT-tcrossprod(ytT)</code> from the <code><a href="MARSShatyt.html">MARSShatyt</a>()</code> output.</p>
<p>The intervals reported by <code>tsSmooth.marssMLE</code> for the missing values take into account all the information in the data, specifically the correlation with other data at time \(t\) if \(\mathbf{R}\) is not diagonal. This is what you want to use for interpolating missing data. You do not want to use <code><a href="predict_marssMLE.html">predict.marssMLE()</a></code> as those predictions are for entirely new data sets and thus will ignore relevant information if \(\mathbf{y}_t\) is multivariate, not all \(\mathbf{y}_t\) are missing, and the \(\mathbf{R}\) matrix is not diagonal.</p>
<p>The standard error and confidence interval for the expected value of the missing data along with the standard deviation and prediction interval for the missing data are reported. The former uses the variance of \(\textrm{E}[\mathbf{Y}_t]\) conditioned on the data while the latter uses variance of \(\mathbf{Y}_t\) conditioned on the data. <code><a href="MARSShatyt.html">MARSShatyt</a>()</code> returns these variances and expected values. See Holmes (2012) for a discussion of the derivation of expectation and variance of \(\mathbf{Y}_t\) conditioned on the observed data (in the section 'Computing the expectations in the update equations').</p>
<p>For <code>type="ytt"</code>, only the estimates are provided. <code><a href="MARSShatyt.html">MARSShatyt</a>()</code> does not return the necessary variances matrices for the standard errors for this cases.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>R. H. Shumway and D. S. Stoffer (2000).  Time series analysis and its applications. Edition 4. Springer-Verlag, New York.</p>
<p>Holmes, E. E. (2012).  Derivation of the EM algorithm for constrained and unconstrained multivariate autoregressive state-space (MARSS) models.  Technical Report. arXiv:1302.3919 [stat.ME]</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">harborSeal</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">11</span>, <span class="fl">12</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="MARSS.html">MARSS</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Success! abstol and log-log tests passed at 55 iterations.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Alert: conv.test.slope.tol is 0.5.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Test with smaller values (&lt;0.1) to ensure convergence.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MARSS fit is</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimation method: kem </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimation converged in 55 iterations. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Log-likelihood: 30.86888 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: -41.73776   AICc: -37.73776   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                           Estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> R.diag                                     0.00450</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U.X.CoastalEstuaries                       0.06050</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U.X.OR.NorthCoast                          0.05227</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U.X.OR.SouthCoast                          0.02148</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.(X.CoastalEstuaries,X.CoastalEstuaries)  0.02499</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.(X.OR.NorthCoast,X.OR.NorthCoast)        0.01994</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.(X.OR.SouthCoast,X.OR.SouthCoast)        0.00297</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.X.CoastalEstuaries                      7.37247</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.X.OR.NorthCoast                         6.26598</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.X.OR.SouthCoast                         7.40658</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Initial states (x0) defined at t=0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Standard errors have not been calculated. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Use MARSSparamCIs to compute CIs and bias estimates.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Make a plot of the estimated states</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu">tsSmooth</span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"xtT"</span>, interval<span class="op">=</span><span class="st">"confidence"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">d</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">.estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, ymin <span class="op">=</span> <span class="va">.conf.low</span>, ymax <span class="op">=</span> <span class="va">.conf.up</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">.rownames</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time Step"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"State estimate"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="tsSmooth_marssMLE-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Make a plot of the estimates for the missing values</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu">tsSmooth</span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"ytT"</span>, interval<span class="op">=</span><span class="st">"confidence"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">d2</span> <span class="op">&lt;-</span> <span class="fu">tsSmooth</span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"ytT"</span>, interval<span class="op">=</span><span class="st">"prediction"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">d</span><span class="op">$</span><span class="va">.lwr</span> <span class="op">&lt;-</span> <span class="va">d2</span><span class="op">$</span><span class="va">.lwr</span></span></span>
<span class="r-in"><span><span class="va">d</span><span class="op">$</span><span class="va">.upr</span> <span class="op">&lt;-</span> <span class="va">d2</span><span class="op">$</span><span class="va">.upr</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">d</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">.estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">.estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, ymin <span class="op">=</span> <span class="va">.conf.low</span>, ymax <span class="op">=</span> <span class="va">.conf.up</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">.lwr</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">.upr</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">.rownames</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time Step"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Blue=data, Black=estimate, grey=CI, dash=prediction interval"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="tsSmooth_marssMLE-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Contrast this with the model prediction of y(t), i.e., put a line through the points</span></span></span>
<span class="r-in"><span><span class="co"># Intervals are for new data not the blue dots </span></span></span>
<span class="r-in"><span><span class="co"># (which were used to fit the model so are not new)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"ytT"</span>, interval<span class="op">=</span><span class="st">"confidence"</span>, level<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">d2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"ytT"</span>, interval<span class="op">=</span><span class="st">"prediction"</span>, level<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">d</span><span class="op">$</span><span class="va">.lwr</span> <span class="op">&lt;-</span> <span class="va">d2</span><span class="op">$</span><span class="va">.lwr</span></span></span>
<span class="r-in"><span><span class="va">d</span><span class="op">$</span><span class="va">.upr</span> <span class="op">&lt;-</span> <span class="va">d2</span><span class="op">$</span><span class="va">.upr</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">d</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">.fitted</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, ymin <span class="op">=</span> <span class="va">.conf.low</span>, ymax <span class="op">=</span> <span class="va">.conf.up</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">.lwr</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">.upr</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">.rownames</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time Step"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Blue=data, Black=estimate, grey=CI, dash=prediction interval"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="tsSmooth_marssMLE-3.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Elizabeth Eli Holmes, Eric J. Ward, Mark D. Scheuerell, Kellie Wills.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

