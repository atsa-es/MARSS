<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function will return the modeled value of \(\mathbf{y}_t\) or \(\mathbf{x}_t\) conditioned on the data (either the data used to fit the model or data in newdata). For \(\mathbf{y}_t\), this is \(\mathbf{Z}_t \mathbf{x}_t^T+\mathbf{a}_t+\mathbf{D}_t\mathbf{d}_t\). For \(\mathbf{x}_t\), this is \(\mathbf{B}_t \mathbf{x}_{t-1}^T+\mathbf{u}_t+\mathbf{C}_t\mathbf{c}_{t}\).  \(\mathbf{x}_t^T\) is the smoothed state estimate at time \(t\) conditioned on all the data (either data used to fit the model or the optional data passed into newdata).
If you want the estimate of \(\mathbf{x}_t\) conditioned on all the data (i.e. output from the Kalman filter or smoother), then use tsSmooth(). Note that the prediction of \(\mathbf{x}_t\) conditioned on the data up to time \(t\) is not provided since that would require the estimate of \(\mathbf{x}_t\) conditioned on data 1 to \(t+1\), which is not output from the Kalman filter or smoother.
If h is passed in, predict(object) will return a forecast \(h\) steps past the end of the model data. predict(object) returns a marssPredict object which can be passed to plot() or ggplot2::autoplot()for automatic plotting of predictions and forecasts with intervals."><title>predict and forecast MARSS MLE objects — predict.marssMLE • MARSS</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><script src="../extra.js"></script><meta property="og:title" content="predict and forecast MARSS MLE objects — predict.marssMLE"><meta property="og:description" content="This function will return the modeled value of \(\mathbf{y}_t\) or \(\mathbf{x}_t\) conditioned on the data (either the data used to fit the model or data in newdata). For \(\mathbf{y}_t\), this is \(\mathbf{Z}_t \mathbf{x}_t^T+\mathbf{a}_t+\mathbf{D}_t\mathbf{d}_t\). For \(\mathbf{x}_t\), this is \(\mathbf{B}_t \mathbf{x}_{t-1}^T+\mathbf{u}_t+\mathbf{C}_t\mathbf{c}_{t}\).  \(\mathbf{x}_t^T\) is the smoothed state estimate at time \(t\) conditioned on all the data (either data used to fit the model or the optional data passed into newdata).
If you want the estimate of \(\mathbf{x}_t\) conditioned on all the data (i.e. output from the Kalman filter or smoother), then use tsSmooth(). Note that the prediction of \(\mathbf{x}_t\) conditioned on the data up to time \(t\) is not provided since that would require the estimate of \(\mathbf{x}_t\) conditioned on data 1 to \(t+1\), which is not output from the Kalman filter or smoother.
If h is passed in, predict(object) will return a forecast \(h\) steps past the end of the model data. predict(object) returns a marssPredict object which can be passed to plot() or ggplot2::autoplot()for automatic plotting of predictions and forecasts with intervals."><meta property="og:image" content="https://atsa-es.github.io/MARSS/logo.png"><!-- mathjax --><script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js">
</script><!--
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
--><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MARSS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.11.8</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/atsa-es/MARSS/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>predict and forecast MARSS MLE objects</h1>
      
      <div class="d-none name"><code>predict_marssMLE.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function will return the modeled value of \(\mathbf{y}_t\) or \(\mathbf{x}_t\) conditioned on the data (either the data used to fit the model or data in <code>newdata</code>). For \(\mathbf{y}_t\), this is \(\mathbf{Z}_t \mathbf{x}_t^T+\mathbf{a}_t+\mathbf{D}_t\mathbf{d}_t\). For \(\mathbf{x}_t\), this is \(\mathbf{B}_t \mathbf{x}_{t-1}^T+\mathbf{u}_t+\mathbf{C}_t\mathbf{c}_{t}\).  \(\mathbf{x}_t^T\) is the smoothed state estimate at time \(t\) conditioned on all the data (either data used to fit the model or the optional data passed into <code>newdata</code>).</p>
<p>If you want the estimate of \(\mathbf{x}_t\) conditioned on all the data (i.e. output from the Kalman filter or smoother), then use <code><a href="tsSmooth_marssMLE.html">tsSmooth</a>()</code>. Note that the prediction of \(\mathbf{x}_t\) conditioned on the data up to time \(t\) is not provided since that would require the estimate of \(\mathbf{x}_t\) conditioned on data 1 to \(t+1\), which is not output from the Kalman filter or smoother.</p>
<p>If <code>h</code> is passed in, <code>predict(object)</code> will return a forecast \(h\) steps past the end of the model data. <code>predict(object)</code> returns a <code><a href="marssPredict-class.html">marssPredict</a></code> object which can be passed to <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> or <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">ggplot2::autoplot()</a></code>for automatic plotting of predictions and forecasts with intervals.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for marssMLE</span></span>
<span><span class="fu"><a href="predict_help.html">predict</a></span><span class="op">(</span><span class="va">object</span>, n.ahead <span class="op">=</span> <span class="fl">0</span>, </span>
<span>     level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.80</span>, <span class="fl">0.95</span><span class="op">)</span>, </span>
<span>     type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ytt1"</span>, <span class="st">"ytT"</span>, <span class="st">"xtT"</span>, <span class="st">"ytt"</span>, <span class="st">"xtt1"</span><span class="op">)</span>, </span>
<span>     newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>t<span class="op">=</span><span class="cn">NULL</span>, y<span class="op">=</span><span class="cn">NULL</span>, c<span class="op">=</span><span class="cn">NULL</span>, d<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span>, </span>
<span>     interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"confidence"</span>, <span class="st">"prediction"</span><span class="op">)</span>, </span>
<span>     fun.kf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MARSSkfas"</span>, <span class="st">"MARSSkfss"</span><span class="op">)</span>, </span>
<span>     x0 <span class="op">=</span> <span class="st">"reestimate"</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>object</dt>
<dd><p>A <code><a href="marssMLE-class.html">marssMLE</a></code> object.</p></dd>

<dt>n.ahead</dt>
<dd><p>Number of steps ahead to forecast. If <code>n.ahead !=0</code>, then <code>newdata</code> is for the forecast, i.e. for the n.ahead time steps after the end of the model data. See details.</p></dd>

<dt>level</dt>
<dd><p>Level for the intervals if <code>interval != "none".</code></p></dd>

<dt>type</dt>
<dd><p><code>ytT</code>, <code>ytt</code> or <code>ytt1</code>: predictions for the observations based on the states estimate at time \(t\) conditioned on all the data, data up to \(t\) or data up to \(t-1\). <code>xtT</code> or <code>xtt1</code>: predictions for the states at time \(t\) based on the states estimate at time \(t-1\) conditioned on all the data or data up to \(t-1\). The data are the data used to fit the model unless <code>y</code> is passed in in <code>newdata</code>.</p></dd>

<dt>newdata</dt>
<dd><p>An optional list with new <code>y</code> (data), <code>c</code> or <code>d</code> (covariates) to use for the predictions or forecasts. <code>y</code>, <code>c</code> or <code>d</code> must have the same structure (matrix dimensions) as used in the <code><a href="MARSS.html">MARSS</a>()</code> call but the number of time steps can be different. <code>t</code> is used if there is ambuiquity as to which time steps the <code>newdata</code> refer to. See examples and details.</p></dd>

<dt>interval</dt>
<dd><p>If <code>interval="confidence"</code>, then the standard error and confidence intervals of the predictions are returned. If <code>interval="prediction"</code>, prediction intervals are returned. See <code><a href="fitted_marssMLE.html">fitted</a></code> for a discussion of the intervals.</p></dd>

<dt>fun.kf</dt>
<dd><p>Only if you want to change the default Kalman filter. Can be ignored.</p></dd>

<dt>x0</dt>
<dd><p>If "reestimate" (the default), then the initial value for the states is re-estimated. If <code>"use.model"</code>, then the initial values in the fitted model (<code>object</code>) are used. If you change the data, then this initial condition may not be appropriate. You can also pass in a new <code>x0</code> to use. It must be a matrix that is the same dimensions as <code>x0</code> in the model. <code>x0</code> is ignored if <code>h!=0</code> since in that case a forecast is being done. See example.</p></dd>

<dt>...</dt>
<dd><p>Other arguments. Not used.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A list with the following components:</p>
<dl><dt>method</dt>
<dd><p>The method used for fitting, e.g. MARSS kem.</p></dd>

<dt>model</dt>
<dd><p>The <code><a href="marssMLE-class.html">marssMLE</a></code> object passed into predict().</p></dd>

<dt>newdata</dt>
<dd><p>The <code>newdata</code> list if passed in.</p></dd>

<dt>level</dt>
<dd><p>The confidence or prediction intervals <code>level</code>.</p></dd>

<dt>pred</dt>
<dd><p>A data frame the predictions or forecasts along with the intervals.</p></dd>

<dt>type</dt>
<dd><p>The <code>type</code> passed in.</p></dd>

<dt>t</dt>
<dd><p>The time steps in the pred data frame.</p></dd>

<dt>n.ahead and h</dt>
<dd><p>The number of forecast time steps.</p></dd>

<dt>x0</dt>
<dd><p>The x0 used for the predictions.</p></dd>

<dt>tinitx</dt>
<dd><p>The tinitx used.</p></dd>


</dl><p>The pred data frame has the following columns:</p>
<dl><dt>.rownames</dt>
<dd><p>Names of the data or states.</p></dd>

<dt>t</dt>
<dd><p>Time step.</p></dd>

<dt>y</dt>
<dd><p>The data if <code>type</code> is <code>"ytT"</code>, <code>"ytt"</code> or <code>"ytt1"</code>.</p></dd>

<dt>xtT</dt>
<dd><p>The estimate of \(\mathbf{x}_t\) conditioned on all the data if <code>type="xtT"</code>. From <code><a href="tsSmooth_marssMLE.html">tsSmooth</a>()</code>.</p></dd>

<dt>xtt</dt>
<dd><p>The estimate of \(\mathbf{x}_t\) conditioned on the data 1 to \(t\) if <code>type="xtt1"</code>. From <code><a href="tsSmooth_marssMLE.html">tsSmooth</a>()</code>.</p></dd>

<dt>estimate</dt>
<dd><p>Model predicted values of observations (\(\mathbf{y}\)) or the states (\(\mathbf{x}\)). See details.</p></dd>


</dl><p>If intervals are returned, the following are added to the data frame:</p>
<dl><dt>se</dt>
<dd><p>Standard errors of the predictions.</p></dd>

<dt>Lo ...</dt>
<dd><p>Lower confidence level at <code>alpha = 1-level</code>. The interval is approximated using qnorm(alpha/2)*se + prediction.</p></dd>

<dt>Hi ...</dt>
<dd><p>Upper confidence level. The interval is approximated using qnorm(1-alpha/2)*se + prediction.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    

<p><strong>Forecasts <code>n.ahead != 0</code></strong></p>
<p>The <code>type="xtT"</code> forecast is the states forecast conditioned on all the data. If <code>n.ahead !=0</code>, then 'data' that is being conditioned on is the original data (model data) plus any data in <code>newdata$y</code> for the h forecast time steps. Note, typically forecasts would not have data, since they are forecasts, but <code>predict.marssMLE()</code> allows you to specify data for the forecast time steps if you need to. If the model includes covariates (\(\mathbf{c}\) and/or \(\mathbf{d}\) matrices passed into the <code>model</code> list in the <code><a href="MARSS.html">MARSS</a>()</code> call), then <code>c</code> and/or <code>d</code> must be passed into <code>newdata</code>.</p>
<p>The <code>type="ytT"</code> forecast is the expected value of NEW data (\(\mathbf{Y}\)) conditioned on the data used for fitting. The data used for fitting is the same as for <code>type="xtT"</code> (above). The \(\mathbf{y}\) forecast is <code>Z xtT[,T+i] + A + D d[,T+i]</code>.</p>
<p>If the model has time-varying parameters, the value of the parameters at the last time step are used for the forecast.</p>
<p><strong>Model predictions <code>n.ahead == 0</code></strong></p>
<p>If <code>newdata</code> is not passed in, then the model data (\(\mathbf{y}\)) and \(\mathbf{c}\) and \(\mathbf{d}\) (if part of model) are used for the predictions. <code><a href="fitted_marssMLE.html">fitted</a>(object, type="ytT")</code> is the internal function for model predictions in that case.</p>
<p>If <code>newdata</code> is passed in, then the predictions are computed using <code>newdata</code> but with the MARSS model estimated from the original data, essentially the Kalman filter/smoother is run using the estimated MARSS model but with data (and \(\mathbf{c}\) and \(\mathbf{d}\) if in the model) in <code>newdata</code>.  <code>y</code>, <code>c</code> and <code>d</code> in the <code>newdata</code> list must all have the same number of columns (time-steps) and the length of <code>t</code> in <code>newdata</code> must be the same as the number of columns and must be sequential.</p>
<p>For <code>type="ytT"</code>, the predictions are conceptually the same as predictions returned by <code>predict.lm</code> for a linear regression. The confidence interval is the interval for the expected value of NEW data. The prediction interval is the interval for NEW data. Prediction intervals will always be wider (or equal if R=0) to confidence intervals. The difference is that the uncertainty in <code>predict.lm</code> comes from parameter uncertainty and the data error while in <code>predict.marssMLE</code>, the uncertainty is from \(\mathbf{x}\) uncertainty and data error. Parameter uncertainty does not enter the interval calculations; parameters are treated as known at their point estimates. This is not specific to the MARSS package. This is how prediction and confidence intervals are presented for MARSS models in the literature, i.e. no parameter uncertainty.</p>
<ul><li><p><code>t</code> in <code>newdata</code>: If the model has time-varying parameters, <code>t</code> in <code>newdata</code> removes any ambiguity as to which parameter values (time steps) will be used for prediction. In this case, <code>t</code> specifies which time values of the parameters you want to use. If you leave off <code>t</code>, then it is assumed that <code>t</code> starts at the first time step in the data used to fit the original model. If the model is time-constant, <code>t</code> is used to set the time step values (used for plotting, etc.).</p></li>
<li><p>The model has \(\mathbf{c}\) and/or \(\mathbf{d}\): <code>c</code> and/or <code>d</code> must be included in <code>newdata</code>. If <code>y</code> (new data) is not in <code>newdata</code>, it is assumed to be absent (all NA). That is, the default behavior if <code>y</code> is absent but <code>c</code> and/or <code>d</code> is present is <code>y="none"</code>. If you want to use the original data used to fit the model, then pass in <code>y="model"</code> in <code>newdata</code>. Pass in <code>t</code> in <code>newdata</code> if it is ambiguous which time steps of the model data to use.</p></li>
<li><p>The model has time-varying parameters: You have to pass in <code>t</code> in <code>newdata</code> to specify what parameter values to use. If any \(t &gt; T\) (\(T\) equals the last time step in the model data), then it is assumed that you want to use the parameter values at the last time step of the original time series for values beyond the last time step. See examples.</p></li>
<li><p><code>y</code>, <code>c</code> and <code>d</code> in <code>newdata</code> have more time steps than the original data: If the model has time-varying parameters, you will need to pass in <code>t</code>. If the model is time-constant, then <code>t</code> is assumed to start at the first time step in the original data but you can pass in <code>t</code> to change that. It will not change the prediction, but will change the t column in the output.</p></li>
</ul><p><strong>x0 estimation</strong> If you are passing in <code>y</code> in <code>newdata</code>, then it is likely that you will need to re-estimate the \(\mathbf{x}\) initial condition. The default behavior of <code>predict.marssMLE</code>. Use <code>x0 = "use.model"</code> to use the initial values in the estimated model (<code>object</code>).</p>


    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="plot_marssPredict.html">plot.marssPredict</a>()</code>, <code><a href="fitted_marssMLE.html">fitted.marssMLE</a>()</code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Eli Holmes, NOAA, Seattle, USA.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">harborSealWA</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span>,<span class="op">]</span> <span class="co">#remove the year row</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="MARSS.html">MARSS</a></span><span class="op">(</span><span class="va">dat</span>, model<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>R<span class="op">=</span><span class="st">"diagonal and equal"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Success! abstol and log-log tests passed at 44 iterations.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Alert: conv.test.slope.tol is 0.5.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Test with smaller values (&lt;0.1) to ensure convergence.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MARSS fit is</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimation method: kem </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimation converged in 44 iterations. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Log-likelihood: 17.84491 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: -15.68982   AICc: -10.45173   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     Estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> R.diag               0.00582</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U.X.SJF              0.06833</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U.X.SJI              0.07084</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> U.X.EBays            0.04221</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.(X.SJF,X.SJF)      0.04150</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.(X.SJI,X.SJI)      0.01271</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.(X.EBays,X.EBays)  0.00807</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.X.SJF             5.97602</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.X.SJI             6.70656</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.X.EBays           6.63306</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Initial states (x0) defined at t=0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Standard errors have not been calculated. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Use MARSSparamCIs to compute CIs and bias estimates.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 2 steps ahead forecast</span></span></span>
<span class="r-in"><span><span class="va">fr</span> <span class="op">&lt;-</span> <span class="fu"><a href="predict_help.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, type<span class="op">=</span><span class="st">"ytT"</span>, n.ahead<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fr</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="predict_marssMLE-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># use model data with the estimated initial values (at t=0) for </span></span></span>
<span class="r-in"><span><span class="co"># initial values at t=9</span></span></span>
<span class="r-in"><span><span class="co"># This would be a somewhat strange thing to do and the value at t=10 will look wrong.</span></span></span>
<span class="r-in"><span><span class="va">fr</span> <span class="op">&lt;-</span> <span class="fu"><a href="predict_help.html">predict</a></span><span class="op">(</span><span class="va">fit</span>,  newdata<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>t<span class="op">=</span><span class="fl">10</span><span class="op">:</span><span class="fl">20</span>, y<span class="op">=</span><span class="va">dat</span><span class="op">[</span>,<span class="fl">10</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span>, x0 <span class="op">=</span> <span class="st">"use.model"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fr</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="predict_marssMLE-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># pass in new data and give it new t; initial conditions will be estimated</span></span></span>
<span class="r-in"><span><span class="va">fr</span> <span class="op">&lt;-</span> <span class="fu"><a href="predict_help.html">predict</a></span><span class="op">(</span><span class="va">fit</span>,  newdata<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>t<span class="op">=</span><span class="fl">23</span><span class="op">:</span><span class="fl">33</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">3</span>,<span class="fl">11</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fr</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>,<span class="fl">12</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="predict_marssMLE-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Covariate example</span></span></span>
<span class="r-in"><span><span class="va">fulldat</span> <span class="op">&lt;-</span> <span class="va">lakeWAplanktonTrans</span></span></span>
<span class="r-in"><span><span class="va">years</span> <span class="op">&lt;-</span> <span class="va">fulldat</span><span class="op">[</span>,<span class="st">"Year"</span><span class="op">]</span><span class="op">&gt;=</span><span class="fl">1965</span> <span class="op">&amp;</span> <span class="va">fulldat</span><span class="op">[</span>,<span class="st">"Year"</span><span class="op">]</span><span class="op">&lt;</span><span class="fl">1975</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">fulldat</span><span class="op">[</span><span class="va">years</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Greens"</span>, <span class="st">"Bluegreens"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="zscore.html">zscore</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">covariates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  Temp <span class="op">=</span> <span class="va">fulldat</span><span class="op">[</span><span class="va">years</span>, <span class="st">"Temp"</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  TP <span class="op">=</span> <span class="va">fulldat</span><span class="op">[</span><span class="va">years</span>, <span class="st">"TP"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">covariates</span> <span class="op">&lt;-</span> <span class="fu"><a href="zscore.html">zscore</a></span><span class="op">(</span><span class="va">covariates</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">A</span> <span class="op">&lt;-</span> <span class="va">U</span> <span class="op">&lt;-</span> <span class="st">"zero"</span></span></span>
<span class="r-in"><span><span class="va">B</span> <span class="op">&lt;-</span> <span class="va">Z</span> <span class="op">&lt;-</span> <span class="st">"identity"</span></span></span>
<span class="r-in"><span><span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">0.16</span>,<span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Q</span> <span class="op">&lt;-</span> <span class="st">"equalvarcov"</span></span></span>
<span class="r-in"><span><span class="va">C</span> <span class="op">&lt;-</span> <span class="st">"unconstrained"</span></span></span>
<span class="r-in"><span><span class="va">model.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>B<span class="op">=</span><span class="va">B</span>,U<span class="op">=</span><span class="va">U</span>,Q<span class="op">=</span><span class="va">Q</span>,Z<span class="op">=</span><span class="va">Z</span>,A<span class="op">=</span><span class="va">A</span>,R<span class="op">=</span><span class="va">R</span>,C<span class="op">=</span><span class="va">C</span>,c<span class="op">=</span><span class="va">covariates</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="MARSS.html">MARSS</a></span><span class="op">(</span><span class="va">dat</span>, model<span class="op">=</span><span class="va">model.list</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Success! abstol and log-log tests passed at 27 iterations.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Alert: conv.test.slope.tol is 0.5.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Test with smaller values (&lt;0.1) to ensure convergence.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MARSS fit is</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimation method: kem </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Convergence test: conv.test.slope.tol = 0.5, abstol = 0.001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimation converged in 27 iterations. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Log-likelihood: -267.8293 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: 551.6585   AICc: 552.3346   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       Estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.diag                  0.2817</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Q.offdiag               0.0648</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.X.Greens            -0.2370</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0.X.Bluegreens        -0.1712</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> C.(X.Greens,Temp)      -0.0512</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> C.(X.Bluegreens,Temp)   0.1004</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> C.(X.Greens,TP)        -0.0466</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> C.(X.Bluegreens,TP)     0.0058</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Initial states (x0) defined at t=0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Standard errors have not been calculated. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Use MARSSparamCIs to compute CIs and bias estimates.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use a new c (covariate) but no data.</span></span></span>
<span class="r-in"><span><span class="va">fr</span> <span class="op">&lt;-</span> <span class="fu"><a href="predict_help.html">predict</a></span><span class="op">(</span><span class="va">fit</span>,  newdata<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>c<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">2</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span>, x0<span class="op">=</span><span class="st">"use.model"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> predict.marssMLE(): prediction is not conditioned on any data, only c or d covariates.</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fr</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="predict_marssMLE-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use first 10 time steps of model data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="predict_help.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, newdata<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">dat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, c<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">2</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="predict_marssMLE-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use all model data but new covariates</span></span></span>
<span class="r-in"><span><span class="co"># Why does it look so awful? Because this is a one-step ahead</span></span></span>
<span class="r-in"><span><span class="co"># prediction and there is no info on what the c will be at t</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="predict_help.html">predict</a></span><span class="op">(</span><span class="va">fit</span>,  newdata<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">dat</span>, c<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">2</span>,<span class="fl">120</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="predict_marssMLE-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use all model data but new covariates with ytT type</span></span></span>
<span class="r-in"><span><span class="co"># this looks better because is uses all the c data to estimate (so knows what c is at t and beyond)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="predict_help.html">predict</a></span><span class="op">(</span><span class="va">fit</span>,  newdata<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">dat</span>, c<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">2</span>,<span class="fl">120</span><span class="op">)</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"ytT"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="predict_marssMLE-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use no data; cannot estimate initial conditions without data</span></span></span>
<span class="r-in"><span><span class="co"># so x0 must be "use.model"</span></span></span>
<span class="r-in"><span><span class="va">fr</span> <span class="op">&lt;-</span> <span class="fu"><a href="predict_help.html">predict</a></span><span class="op">(</span><span class="va">fit</span>,  newdata<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>c<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">2</span>,<span class="fl">22</span><span class="op">)</span><span class="op">)</span>, x0<span class="op">=</span><span class="st">"use.model"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> predict.marssMLE(): prediction is not conditioned on any data, only c or d covariates.</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fr</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="predict_marssMLE-8.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># forecast with covariates</span></span></span>
<span class="r-in"><span><span class="co"># n.ahead and the number column in your covariates in newdata must match</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="predict_help.html">predict</a></span><span class="op">(</span><span class="va">fit</span>,  newdata<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>c<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">2</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span>, n.ahead<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="predict_marssMLE-9.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># forecast with covariates and only show last 10 steps of original data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="predict_help.html">predict</a></span><span class="op">(</span><span class="va">fit</span>,  newdata<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>c<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">2</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span>, n.ahead<span class="op">=</span><span class="fl">10</span><span class="op">)</span>, include<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="predict_marssMLE-10.png" alt="" width="700" height="433"></span>
<span class="r-in"><span>    </span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Elizabeth Eli Holmes, Eric J. Ward, Mark D. Scheuerell, Kellie Wills.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

